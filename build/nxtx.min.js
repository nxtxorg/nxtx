!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).nxtx=r()}(this,function(){"use strict";function e(e,r,t,n){return new(t||(t=Promise))(function(o,u){function a(e){try{c(n.next(e))}catch(e){u(e)}}function i(e){try{c(n.throw(e))}catch(e){u(e)}}function c(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(a,i)}c((n=n.apply(e,r||[])).next())})}function r(e,r){var t,n,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=r.call(e,a)}catch(e){u=[6,e],n=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}}var t=function(){function e(r,t,n,o){this.message=r,this.expected=t,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,r){function t(){this.constructor=e}t.prototype=r.prototype,e.prototype=new t}(e,Error),e.buildMessage=function(e,r){var t={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var r,t="";for(r=0;r<e.parts.length;r++)t+=e.parts[r]instanceof Array?u(e.parts[r][0])+"-"+u(e.parts[r][1]):u(e.parts[r]);return"["+(e.inverted?"^":"")+t+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function u(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}return"Expected "+function(e){var r,n,o,u=new Array(e.length);for(r=0;r<e.length;r++)u[r]=(o=e[r],t[o.type](o));if(u.sort(),u.length>0){for(r=1,n=1;r<u.length;r++)u[r-1]!==u[r]&&(u[n]=u[r],n++);u.length=n}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(r)+" found."},{SyntaxError:e,parse:function(r,t){t=void 0!==t?t:{};var n,o={},u={Paragraphs:er},a=er,i=function(e,r){return[e,...r]},c=function(e){return[e]},s=function(e){return{type:pr.PARAGRAPH,value:e,location:We(Ye,Ge)}},l=Ke("paragraph"),f=Ke("text"),h=function(e){return{type:pr.TEXT,value:e.join("")}},p="\\\\",d=Ze("\\\\",!1),v=function(){return"\\"},y=/^[^\r\n\\]/,m=Je(["\r","\n","\\"],!0,!1),g=function(){return Xe()},A=Ke("command"),b="\\",x=Ze("\\",!1),C=function(e,r){return{type:pr.INVOCATION,name:e,args:r||[]}},w=Ke("command name"),P=/^[_:\-]/,k=Je(["_",":","-"],!1,!1),E=/^[a-zA-Z!#-&*-+\--\/;-@]/,O=Je([["a","z"],["A","Z"],"!",["#","&"],["*","+"],["-","/"],[";","@"]],!1,!1),j=/^[0-9]/,N=Je([["0","9"]],!1,!1),R="(",T=Ze("(",!1),_=")",I=Ze(")",!1),S=function(e){return e},M=/^[^)]/,B=Je([")"],!0,!1),F=function(e){return[{type:pr.STRING,value:e.join("")}]},L=Ke("command arguments"),D=",",H=Ze(",",!1),G=Ke("name"),Y=function(e){return{type:pr.STRING,value:e}},z=Ke("boolean"),U="true",q=Ze("true",!1),V="false",X=Ze("false",!1),Z=function(){return{type:pr.BOOLEAN,value:"true"===Xe()}},J=Ke("number"),K="-",Q=Ze("-",!1),W=".",$=Ze(".",!1),ee=function(e){return{type:pr.NUMBER,value:e?parseFloat(Xe()):parseInt(Xe(),10)}},re=Ke("string"),te='"',ne=Ze('"',!1),oe=/^[^"]/,ue=Je(['"'],!0,!1),ae=function(e){return{type:pr.STRING,value:e.join("")}},ie="'",ce=Ze("'",!1),se=/^[^']/,le=Je(["'"],!0,!1),fe=Ke("array"),he="[",pe=Ze("[",!1),de="]",ve=Ze("]",!1),ye=function(e){return{type:pr.ARRAY,value:e}},me=function(){return{type:pr.ARRAY,value:[]}},ge=Ke("dictionary"),Ae="{",be=Ze("{",!1),xe="}",Ce=Ze("}",!1),we=function(e){return{type:pr.DICTIONARY,value:e.reduce((e,r)=>(e[r.name]=r.value)&&e,{})}},Pe=function(){return{type:pr.DICTIONARY,value:{}}},ke=Ke("key-value pair(s)"),Ee=Ke("key-value pair"),Oe=":",je=Ze(":",!1),Ne=function(e,r){return{name:e,value:r}},Re=function(e,r){return{key:e.value,value:r}},Te=Ke("newline"),_e="\r\n",Ie=Ze("\r\n",!1),Se="\r",Me=Ze("\r",!1),Be="\n",Fe=Ze("\n",!1),Le=Ke("optional inline whitespace"),De=/^[ \t]/,He=Je([" ","\t"],!1,!1),Ge=0,Ye=0,ze=[{line:1,column:1}],Ue=0,qe=[],Ve=0;if("startRule"in t){if(!(t.startRule in u))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=u[t.startRule]}function Xe(){return r.substring(Ye,Ge)}function Ze(e,r){return{type:"literal",text:e,ignoreCase:r}}function Je(e,r,t){return{type:"class",parts:e,inverted:r,ignoreCase:t}}function Ke(e){return{type:"other",description:e}}function Qe(e){var t,n=ze[e];if(n)return n;for(t=e-1;!ze[t];)t--;for(n={line:(n=ze[t]).line,column:n.column};t<e;)10===r.charCodeAt(t)?(n.line++,n.column=1):n.column++,t++;return ze[e]=n,n}function We(e,r){var t=Qe(e),n=Qe(r);return{start:{offset:e,line:t.line,column:t.column},end:{offset:r,line:n.line,column:n.column}}}function $e(e){Ge<Ue||(Ge>Ue&&(Ue=Ge,qe=[]),qe.push(e))}function er(){var e,r,t,n,u,a;for(e=Ge,r=[],t=fr();t!==o;)r.push(t),t=fr();if(r!==o)if((t=rr())!==o)if((n=fr())!==o){if(u=[],(a=fr())!==o)for(;a!==o;)u.push(a),a=fr();else u=o;u!==o&&(a=er())!==o?(Ye=e,e=r=i(t,a)):(Ge=e,e=o)}else Ge=e,e=o;else Ge=e,e=o;else Ge=e,e=o;if(e===o){for(e=Ge,r=[],t=fr();t!==o;)r.push(t),t=fr();if(r!==o)if((t=rr())!==o){for(n=[],u=fr();u!==o;)n.push(u),u=fr();n!==o?(Ye=e,e=r=c(t)):(Ge=e,e=o)}else Ge=e,e=o;else Ge=e,e=o}return e}function rr(){var e,r;return e=Ge,(r=function e(){var r,t,n,u;return Ve++,r=Ge,(t=tr())!==o?((n=fr())===o&&(n=null),n!==o&&(u=e())!==o?(Ye=r,t=i(t,u),r=t):(Ge=r,r=o)):(Ge=r,r=o),r===o&&(r=Ge,(t=tr())!==o&&(Ye=r,t=c(t)),r=t),Ve--,r===o&&(t=o,0===Ve&&$e(l)),r}())!==o&&(Ye=e,r=s(r)),e=r}function tr(){var e;return(e=or())===o&&(e=function(){var e,r,t;if(Ve++,e=Ge,r=[],(t=nr())!==o)for(;t!==o;)r.push(t),t=nr();else r=o;return r!==o&&(Ye=e,r=h(r)),Ve--,(e=r)===o&&(r=o,0===Ve&&$e(f)),e}()),e}function nr(){var e,t,n;if(Ve++,e=Ge,r.substr(Ge,2)===p?(t=p,Ge+=2):(t=o,0===Ve&&$e(d)),t!==o&&(Ye=e,t=v()),(e=t)===o){if(e=Ge,t=[],y.test(r.charAt(Ge))?(n=r.charAt(Ge),Ge++):(n=o,0===Ve&&$e(m)),n!==o)for(;n!==o;)t.push(n),y.test(r.charAt(Ge))?(n=r.charAt(Ge),Ge++):(n=o,0===Ve&&$e(m));else t=o;t!==o&&(Ye=e,t=g()),e=t}return Ve--,e===o&&(t=o,0===Ve&&$e(f)),e}function or(){var e,t,n,u;return Ve++,e=Ge,92===r.charCodeAt(Ge)?(t=b,Ge++):(t=o,0===Ve&&$e(x)),t!==o&&(n=ur())!==o?((u=function(){var e,t,n,u,a;if(e=Ge,40===r.charCodeAt(Ge)?(t=R,Ge++):(t=o,0===Ve&&$e(T)),t!==o&&(n=hr())!==o&&(u=ir())!==o&&hr()!==o?(41===r.charCodeAt(Ge)?(a=_,Ge++):(a=o,0===Ve&&$e(I)),a!==o?(Ye=e,t=S(u),e=t):(Ge=e,e=o)):(Ge=e,e=o),e===o)if(e=Ge,40===r.charCodeAt(Ge)?(t=R,Ge++):(t=o,0===Ve&&$e(T)),t!==o){if(n=[],M.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(B)),u!==o)for(;u!==o;)n.push(u),M.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(B));else n=o;n!==o?(41===r.charCodeAt(Ge)?(u=_,Ge++):(u=o,0===Ve&&$e(I)),u!==o?(Ye=e,t=F(n),e=t):(Ge=e,e=o)):(Ge=e,e=o)}else Ge=e,e=o;return e}())===o&&(u=null),u!==o?(Ye=e,e=t=C(n,u)):(Ge=e,e=o)):(Ge=e,e=o),Ve--,e===o&&(t=o,0===Ve&&$e(A)),e}function ur(){var e,t,n;return Ve++,e=Ge,(t=ar())!==o&&(n=ur())!==o?(Ye=e,e=t=g()):(Ge=e,e=o),e===o&&(e=Ge,(t=ar())!==o?(P.test(r.charAt(Ge))?(n=r.charAt(Ge),Ge++):(n=o,0===Ve&&$e(k)),n!==o&&ur()!==o?(Ye=e,e=t=g()):(Ge=e,e=o)):(Ge=e,e=o),e===o&&(e=Ge,(t=ar())!==o&&(Ye=e,t=g()),e=t)),Ve--,e===o&&(t=o,0===Ve&&$e(w)),e}function ar(){var e,t,n;return e=Ge,E.test(r.charAt(Ge))?(t=r.charAt(Ge),Ge++):(t=o,0===Ve&&$e(O)),t!==o?(j.test(r.charAt(Ge))?(n=r.charAt(Ge),Ge++):(n=o,0===Ve&&$e(N)),n===o&&(n=null),n!==o?e=t=[t,n]:(Ge=e,e=o)):(Ge=e,e=o),e}function ir(){var e,t,n,u,a;return Ve++,e=Ge,(t=cr())!==o&&hr()!==o?(44===r.charCodeAt(Ge)?(n=D,Ge++):(n=o,0===Ve&&$e(H)),n!==o&&hr()!==o?((u=fr())===o&&(u=null),u!==o&&hr()!==o&&(a=ir())!==o?(Ye=e,e=t=i(t,a)):(Ge=e,e=o)):(Ge=e,e=o)):(Ge=e,e=o),e===o&&(e=Ge,(t=cr())!==o&&(Ye=e,t=c(t)),e=t),Ve--,e===o&&(t=o,0===Ve&&$e(L)),e}function cr(){var e;return(e=function(){var e,t;return Ve++,e=Ge,r.substr(Ge,4)===U?(t=U,Ge+=4):(t=o,0===Ve&&$e(q)),t===o&&(r.substr(Ge,5)===V?(t=V,Ge+=5):(t=o,0===Ve&&$e(X))),t!==o&&(Ye=e,t=Z()),Ve--,(e=t)===o&&(t=o,0===Ve&&$e(z)),e}())===o&&(e=function(){var e,t,n,u,a,s;return Ve++,e=Ge,123===r.charCodeAt(Ge)?(t=Ae,Ge++):(t=o,0===Ve&&$e(be)),t!==o&&hr()!==o?((n=fr())===o&&(n=null),n!==o&&hr()!==o&&(u=function e(){var t,n,u,a,s;return Ve++,t=Ge,(n=lr())!==o&&hr()!==o?(44===r.charCodeAt(Ge)?(u=D,Ge++):(u=o,0===Ve&&$e(H)),u===o&&(u=null),u!==o&&fr()!==o&&(a=hr())!==o&&(s=e())!==o?(Ye=t,n=i(n,s),t=n):(Ge=t,t=o)):(Ge=t,t=o),t===o&&(t=Ge,(n=lr())!==o&&hr()!==o?(44===r.charCodeAt(Ge)?(u=D,Ge++):(u=o,0===Ve&&$e(H)),u!==o&&hr()!==o&&(a=e())!==o?(Ye=t,n=i(n,a),t=n):(Ge=t,t=o)):(Ge=t,t=o),t===o&&(t=Ge,(n=lr())!==o&&(Ye=t,n=c(n)),t=n)),Ve--,t===o&&(n=o,0===Ve&&$e(ke)),t}())!==o&&hr()!==o?((a=fr())===o&&(a=null),a!==o&&hr()!==o?(125===r.charCodeAt(Ge)?(s=xe,Ge++):(s=o,0===Ve&&$e(Ce)),s!==o?(Ye=e,t=we(u),e=t):(Ge=e,e=o)):(Ge=e,e=o)):(Ge=e,e=o)):(Ge=e,e=o),e===o&&(e=Ge,123===r.charCodeAt(Ge)?(t=Ae,Ge++):(t=o,0===Ve&&$e(be)),t!==o&&hr()!==o?(125===r.charCodeAt(Ge)?(n=xe,Ge++):(n=o,0===Ve&&$e(Ce)),n!==o?(Ye=e,t=Pe(),e=t):(Ge=e,e=o)):(Ge=e,e=o)),Ve--,e===o&&(t=o,0===Ve&&$e(ge)),e}())===o&&(e=function(){var e,t,n,u,a,i;return Ve++,e=Ge,91===r.charCodeAt(Ge)?(t=he,Ge++):(t=o,0===Ve&&$e(pe)),t!==o&&hr()!==o?((n=fr())===o&&(n=null),n!==o&&hr()!==o&&(u=ir())!==o&&hr()!==o?((a=fr())===o&&(a=null),a!==o&&hr()!==o?(93===r.charCodeAt(Ge)?(i=de,Ge++):(i=o,0===Ve&&$e(ve)),i!==o?(Ye=e,t=ye(u),e=t):(Ge=e,e=o)):(Ge=e,e=o)):(Ge=e,e=o)):(Ge=e,e=o),e===o&&(e=Ge,91===r.charCodeAt(Ge)?(t=he,Ge++):(t=o,0===Ve&&$e(pe)),t!==o&&hr()!==o?(93===r.charCodeAt(Ge)?(n=de,Ge++):(n=o,0===Ve&&$e(ve)),n!==o?(Ye=e,t=me(),e=t):(Ge=e,e=o)):(Ge=e,e=o)),Ve--,e===o&&(t=o,0===Ve&&$e(fe)),e}())===o&&(e=or())===o&&(e=function(){var e,t,n,u,a,i,c;if(Ve++,e=Ge,45===r.charCodeAt(Ge)?(t=K,Ge++):(t=o,0===Ve&&$e(Q)),t===o&&(t=null),t!==o){if(n=[],j.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(N)),u!==o)for(;u!==o;)n.push(u),j.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(N));else n=o;if(n!==o){if(u=Ge,46===r.charCodeAt(Ge)?(a=W,Ge++):(a=o,0===Ve&&$e($)),a!==o){if(i=[],j.test(r.charAt(Ge))?(c=r.charAt(Ge),Ge++):(c=o,0===Ve&&$e(N)),c!==o)for(;c!==o;)i.push(c),j.test(r.charAt(Ge))?(c=r.charAt(Ge),Ge++):(c=o,0===Ve&&$e(N));else i=o;i!==o?u=a=[a,i]:(Ge=u,u=o)}else Ge=u,u=o;u===o&&(u=null),u!==o?(Ye=e,t=ee(u),e=t):(Ge=e,e=o)}else Ge=e,e=o}else Ge=e,e=o;return Ve--,e===o&&(t=o,0===Ve&&$e(J)),e}())===o&&(e=function(){var e,r;return Ve++,e=Ge,(r=ur())!==o&&(Ye=e,r=Y(r)),Ve--,(e=r)===o&&(r=o,0===Ve&&$e(G)),e}())===o&&(e=sr()),e}function sr(){var e,t,n,u;if(Ve++,e=Ge,34===r.charCodeAt(Ge)?(t=te,Ge++):(t=o,0===Ve&&$e(ne)),t!==o){for(n=[],oe.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(ue));u!==o;)n.push(u),oe.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(ue));n!==o?(34===r.charCodeAt(Ge)?(u=te,Ge++):(u=o,0===Ve&&$e(ne)),u!==o?(Ye=e,e=t=ae(n)):(Ge=e,e=o)):(Ge=e,e=o)}else Ge=e,e=o;if(e===o)if(e=Ge,39===r.charCodeAt(Ge)?(t=ie,Ge++):(t=o,0===Ve&&$e(ce)),t!==o){for(n=[],se.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(le));u!==o;)n.push(u),se.test(r.charAt(Ge))?(u=r.charAt(Ge),Ge++):(u=o,0===Ve&&$e(le));n!==o?(39===r.charCodeAt(Ge)?(u=ie,Ge++):(u=o,0===Ve&&$e(ce)),u!==o?(Ye=e,e=t=ae(n)):(Ge=e,e=o)):(Ge=e,e=o)}else Ge=e,e=o;return Ve--,e===o&&(t=o,0===Ve&&$e(re)),e}function lr(){var e,t,n,u;return Ve++,e=Ge,(t=ur())!==o&&hr()!==o?(58===r.charCodeAt(Ge)?(n=Oe,Ge++):(n=o,0===Ve&&$e(je)),n!==o&&hr()!==o&&(u=cr())!==o?(Ye=e,e=t=Ne(t,u)):(Ge=e,e=o)):(Ge=e,e=o),e===o&&(e=Ge,(t=sr())!==o&&hr()!==o?(58===r.charCodeAt(Ge)?(n=Oe,Ge++):(n=o,0===Ve&&$e(je)),n!==o&&hr()!==o&&(u=cr())!==o?(Ye=e,e=t=Re(t,u)):(Ge=e,e=o)):(Ge=e,e=o)),Ve--,e===o&&(t=o,0===Ve&&$e(Ee)),e}function fr(){var e;return Ve++,r.substr(Ge,2)===_e?(e=_e,Ge+=2):(e=o,0===Ve&&$e(Ie)),e===o&&(13===r.charCodeAt(Ge)?(e=Se,Ge++):(e=o,0===Ve&&$e(Me)),e===o&&(10===r.charCodeAt(Ge)?(e=Be,Ge++):(e=o,0===Ve&&$e(Fe)))),Ve--,e===o&&0===Ve&&$e(Te),e}function hr(){var e,t;for(Ve++,e=[],De.test(r.charAt(Ge))?(t=r.charAt(Ge),Ge++):(t=o,0===Ve&&$e(He));t!==o;)e.push(t),De.test(r.charAt(Ge))?(t=r.charAt(Ge),Ge++):(t=o,0===Ve&&$e(He));return Ve--,e===o&&(t=o,0===Ve&&$e(Le)),e}const pr={PARAGRAPH:1,INVOCATION:2,TEXT:3,BOOLEAN:10,DICTIONARY:11,ARRAY:12,NUMBER:13,STRING:14};if((n=a())!==o&&Ge===r.length)return n;throw n!==o&&Ge<r.length&&$e({type:"end"}),function(r,t,n){return new e(e.buildMessage(r,t),r,t,n)}(qe,Ue<r.length?r.charAt(Ue):null,Ue<r.length?We(Ue,Ue+1):We(Ue,Ue))}}}();function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,r){return e(r={exports:{}},r.exports),r.exports}var u=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,r){function t(){var r=t.__proto__.apply(this,arguments);return Object.assign(r,e.apply(null,arguments)),r}return r=r||Error,Object.setPrototypeOf(t,r),t}r.SubError=n(function(e){return{name:"SubError",message:"SubError "+e.reduce(function(e,r){return e+="\n\n"+r.stack},""),errors:e}},Error),r.IterableError=n(function(e){return{name:"IterableError",message:"expecting an array or an iterable object but got "+(null===e?"null":void 0===e?"undefined":t(e))}},TypeError)});n(u);u.SubError,u.IterableError;var a=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.size=function(e){return Array.isArray(e)?e.length:Object.keys(e).length},r.repeat=function(e,r){for(var t=0;t<e;t++)r(t)},r.toArray=function(e){return Object.keys(e).map(function(r){return e[r]})},r.toBoolean=function(e){return!!e},r.identity=function(e){return e},r.defaults=function(e,r){var t=Object.assign({},r);return Object.keys(e).reduce(function(t,n){return t[n]=void 0===e[n]?r[n]:e[n],t},t)},r.isIterable=function(e){return e&&"function"==typeof e.entries},r.noop=function(){},r.isDefined=function(e){return void 0!==e}});n(a);a.size,a.repeat,a.toArray,a.toBoolean,a.identity,a.defaults,a.isIterable,a.noop,a.isDefined;var i=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(e){return Array.isArray(e)?Promise.all(e):Promise.resolve(e)}(e).then(function(e){return r&&!(0,a.isIterable)(e)?Promise.reject((0,u.IterableError)(e)):e})}});n(i);var c=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.identity;return(0,n.default)(e).then(function(e){return Promise.all(e.map(r))})};var t,n=(t=i)&&t.__esModule?t:{default:t}})),s=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){return function(t){return t.reduce(function(r,n,o){return r.then(function(r){return e(r,n,o,t)})},Promise.resolve(r))}}});n(s);var l,f=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){return Promise.all(e).then((0,n.default)(function(e,t,n,o){return Promise.resolve(t).then(function(e){return r(e,n,o)}).then(function(r){return e.push(r),e})},[]))};var t,n=(t=s)&&t.__esModule?t:{default:t}})),h=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r,o){return(0,n.default)(e).then((0,t.default)(r,o))};var t=o(s),n=o(i);function o(e){return e&&e.__esModule?e:{default:e}}}));!function(e){e[e.Paragraph=1]="Paragraph",e[e.Invocation=2]="Invocation",e[e.Text=3]="Text",e[e.Block=4]="Block",e[e.Html=5]="Html",e[e.Node=6]="Node",e[e.Boolean=10]="Boolean",e[e.Dictionary=11]="Dictionary",e[e.Array=12]="Array",e[e.Number=13]="Number",e[e.String=14]="String"}(l||(l={}));var p=t,d=function(e,r,t,n){if(void 0===n&&(n=!1),!n&&void 0!==e[r])return console.warn("Command '"+r+"' is already registered. Set overwrite to true, if you need to overwrite the already registered command.");e[r]=t},v={".":!0,",":!0},y=function(e){var r=[],t=e.value.reduce(function(e,t){return t.type===l.Text?v[t.value[0]]?(e.push({type:l.Text,value:t.value[0]+" "}),1!==t.value.length&&r.push({type:l.Text,value:t.value.substr(1)})):r.push(t):(r.length&&(e.push({type:l.Text,value:r.map(function(e){return e.value}).join(" ")}),r.length=0),e.push(t)),e},[]);return r.length&&t.push({type:l.Text,value:r.map(function(e){return e.value}).join(" ")}),{type:e.type,value:t}},m=function(e){return!!e},g=function(t,n){return e(void 0,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,c(t,n)];case 1:return[2,e.sent().flat()]}})})},A=function(t,n){return e(void 0,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,c(t,n)];case 1:return[2,e.sent().flat().filter(m)]}})})},b=function(e){var r,t=!0;return e.reduce(function(e,n){return n.type===l.Paragraph?t=e.push.apply(e,b(n.value))&&!0:(t&&(t=e.push(r={type:l.Paragraph,value:[]})&&!1),r.value.push(n)),e},[]).flat()},x=function(e){switch(e.type){case l.Number:case l.String:case l.Boolean:return e.value;case l.Array:return e.value.map(x);case l.Dictionary:return Object.keys(e.value).reduce(function(r,t){return r[t]=x(e.value[t]),r},{})}};return new(function(){function t(){var t=this;this.hooks={prerender:new Array,midrender:new Array,postrender:new Array},this.registeredPackages=new Array,this.commands={},this.preprocessors={},this.baseRenderNode=function(n){return e(t,void 0,void 0,function(){var e,t;return r(this,function(r){switch(r.label){case 0:if("string"==typeof n)return[2,this.text(n)];if(!n.type)return[2,n];switch(n.type){case l.Node:return[3,1];case l.Paragraph:return[3,2];case l.Html:return[3,4];case l.Text:return[3,5];case l.Invocation:return[3,6]}return[3,9];case 1:return[2,n];case 2:return[4,g(n.value,this.baseRenderNode)];case 3:return(e=r.sent()).length&&e.push(this.htmlLite("div",{class:"meta paragraph-break"})),[2,e];case 4:return[2,this.htmlLite("span",{innerHTML:n.value})];case 5:return[2,document.createTextNode(n.value)];case 6:return[4,this.executeCommand(n.name,n.args)];case 7:return t=[r.sent()].flat().filter(m),[4,g(t,this.baseRenderNode)];case 8:return[2,r.sent()];case 9:return console.error("Unrecognized node",n),[2]}})})},this.executeCommand=function(n,o){return e(t,void 0,void 0,function(){var e,t,u,a,i,s=this;return r(this,function(r){switch(r.label){case 0:if(void 0===this.commands[n])return[3,6];r.label=1;case 1:return r.trys.push([1,4,,6]),t=(e=(i=this.commands)[n]).apply,u=[i],[4,c(o,function(e){return e.type===l.Invocation?s.executeCommand(e.name,e.args):e})];case 2:return[4,t.apply(e,u.concat([r.sent()]))];case 3:return[2,r.sent()];case 4:return a=r.sent(),console.error("commmand "+n+" threw error",a),[4,this.html("b",{class:"error"},"commmand "+n+" threw error")];case 5:return[2,r.sent()];case 6:return console.warn("Command '"+n+"' not registered"),[4,this.html("b",{class:"error"},n+"?")];case 7:return[2,r.sent()]}})})},this.executePreprocessor=function(n){return e(t,void 0,void 0,function(){var e,t,o,u,a;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,6,,8]),n.type===l.Invocation&&this.preprocessors[n.name]?[4,(a=this.preprocessors)[n.name].apply(a,n.args)]:[3,3];case 1:return e=[r.sent()].flat().filter(m),[4,g(e,this.executePreprocessor)];case 2:return t=r.sent(),void 0===this.commands[n.name]?[2,t]:[3,5];case 3:return n.type!==l.Paragraph?[3,5]:(o=n,[4,A(n.value,this.executePreprocessor)]);case 4:o.value=r.sent(),r.label=5;case 5:return[2,n];case 6:return u=r.sent(),console.error("preprocessor "+n.name+" threw error",u),[4,this.html("b",{class:"error"},"preprocessor "+n.name+" threw error")];case 7:return[2,r.sent()];case 8:return[2]}})})},this.executePreprocessors=function(n){return e(t,void 0,void 0,function(){var t=this;return r(this,function(o){switch(o.label){case 0:return[4,h(n,function(n,o){return e(t,void 0,void 0,function(){var e;return r(this,function(r){switch(r.label){case 0:return[4,A(o.value,this.executePreprocessor)];case 1:return e=r.sent(),n.push.apply(n,b(e)),[2,n]}})})},[])];case 1:return[2,o.sent()]}})})}}return t.trigger=function(e){return e.forEach(function(e){return e()})},t.prototype.registerCommand=function(e,r,t){return d(this.commands,e,r,t)},t.prototype.registerPreprocessor=function(e,r,t){return d(this.preprocessors,e,r,t)},t.prototype.verifyArguments=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=r.map(function(r,t){return{expected:e[t],actual:r.type,index:t}}).filter(function(e){return e.expected!==e.actual});return{ok:0===n.length,invalid:n}},t.prototype.jsArguments=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.map(x)},t.prototype.jsArgument=function(e){return x(e)},t.prototype.parse=function(e){return p.parse(e).map(y)},t.prototype.registerPackage=function(e){var r=this;e.commands&&Object.keys(e.commands).forEach(function(t){return r.registerCommand(t,e.commands[t])}),e.preprocessors&&Object.keys(e.preprocessors).forEach(function(t){return r.registerPreprocessor(t,e.preprocessors[t])}),e.hooks&&(e.hooks.prerender&&this.on("prerender",e.hooks.prerender),e.hooks.postrender&&this.on("postrender",e.hooks.postrender)),e.requires&&e.requires.forEach(function(t){r.registeredPackages.includes(t)||console.warn("Package '"+e.name+"' requires '"+t+"' which has not been registered")}),this.registeredPackages.push(e.name)},t.prototype.render=function(n,o){return e(this,void 0,void 0,function(){var u,a,i,c,s,l,h=this;return r(this,function(p){switch(p.label){case 0:for(;o.firstChild;)o.removeChild(o.firstChild);return u=0,(i=function(){o.appendChild(a=h.htmlLite("section",{id:"page-"+ ++u,class:"sheet","data-page":u})),a.appendChild(h.htmlLite("div",{class:"meta page-start"}))})(),c=function(e){a.appendChild(e),a.scrollHeight>a.clientHeight&&(i(),a.appendChild(e))},t.trigger(this.hooks.prerender),s=this.parse(n).map(y),[4,this.executePreprocessors(s)];case 1:return l=p.sent(),t.trigger(this.hooks.midrender),[4,f(l,function(t){return e(h,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.baseRenderNode(t)];case 1:return[2,e.sent()]}})})})];case 2:return p.sent().forEach(function(e){return e.forEach(c)}),t.trigger(this.hooks.postrender),[2]}})})},t.prototype.text=function(e){return document.createTextNode(e)},t.prototype.htmlLite=function(e,r){for(var t=this,n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var u=document.createElement(e);return Object.keys(r||{}).forEach(function(e){return u.setAttribute(e,r[e])}),n.forEach(function(e){return"string"==typeof e?u.appendChild(t.text(e)):u.appendChild(e)}),u},t.prototype.html=function(t,n){for(var o=[],u=2;u<arguments.length;u++)o[u-2]=arguments[u];return e(this,void 0,void 0,function(){var e,u,a,i;return r(this,function(r){switch(r.label){case 0:e=this.htmlLite(t,n),u=0,r.label=1;case 1:return u<o.length?(i=(a=e).appendChild,[4,this.baseRenderNode(o[u])]):[3,4];case 2:i.apply(a,[r.sent()]),r.label=3;case 3:return u++,[3,1];case 4:return[2,e]}})})},t.prototype.on=function(e,r){this.hooks[e].includes(r)||this.hooks[e].push(r)},t.prototype.off=function(e,r){var t=this.hooks[e].indexOf(r);-1!==t&&this.hooks[e].splice(t,1)},t}())});
//# sourceMappingURL=nxtx.min.js.map
