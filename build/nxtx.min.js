!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).nxtx=r()}(this,function(){"use strict";function e(e,r,t,n){return new(t||(t=Promise))(function(o,u){function a(e){try{c(n.next(e))}catch(e){u(e)}}function i(e){try{c(n.throw(e))}catch(e){u(e)}}function c(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(a,i)}c((n=n.apply(e,r||[])).next())})}function r(e,r){var t,n,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=r.call(e,a)}catch(e){u=[6,e],n=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}}var t=function(){function e(r,t,n,o){this.message=r,this.expected=t,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,r){function t(){this.constructor=e}t.prototype=r.prototype,e.prototype=new t}(e,Error),e.buildMessage=function(e,r){var t={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var r,t="";for(r=0;r<e.parts.length;r++)t+=e.parts[r]instanceof Array?u(e.parts[r][0])+"-"+u(e.parts[r][1]):u(e.parts[r]);return"["+(e.inverted?"^":"")+t+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function u(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}return"Expected "+function(e){var r,n,o,u=new Array(e.length);for(r=0;r<e.length;r++)u[r]=(o=e[r],t[o.type](o));if(u.sort(),u.length>0){for(r=1,n=1;r<u.length;r++)u[r-1]!==u[r]&&(u[n]=u[r],n++);u.length=n}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(r)+" found."},{SyntaxError:e,parse:function(r,t){t=void 0!==t?t:{};var n,o={},u={Paragraphs:We},a=We,i=function(e,r){return[e,...r]},c=function(e){return[e]},s=function(e){return{type:fr.PARAGRAPH,value:e,location:Qe(He,Le)}},l=Je("paragraph"),f=Je("text"),h=function(e){return{type:fr.TEXT,value:e.join("")}},p="\\\\",d=Xe("\\\\",!1),v=function(){return"\\"},y=/^[^\r\n\\]/,m=Ze(["\r","\n","\\"],!0,!1),g=function(){return qe()},A=Je("command"),b="\\",x=Xe("\\",!1),C=function(e,r){return{type:fr.COMMAND,name:e,args:r||[]}},w=Je("command name"),P=/^[_:\-]/,k=Ze(["_",":","-"],!1,!1),E=/^[a-zA-Z!#-&*-+\--\/;-@]/,j=Ze([["a","z"],["A","Z"],"!",["#","&"],["*","+"],["-","/"],[";","@"]],!1,!1),O=/^[0-9]/,R=Ze([["0","9"]],!1,!1),_="(",N=Xe("(",!1),T=")",S=Xe(")",!1),M=function(e){return e},I=/^[^)]/,B=Ze([")"],!0,!1),D=function(e){return[{type:fr.STRING,value:e.join("")}]},F=Je("command arguments"),L=",",H=Xe(",",!1),G=Je("name"),Y=function(e){return{type:fr.STRING,value:e}},z=Je("boolean"),U="true",q=Xe("true",!1),X="false",Z=Xe("false",!1),J=function(){return{type:fr.BOOLEAN,value:"true"===qe()}},K=Je("number"),Q=".",V=Xe(".",!1),W=function(e){return{type:fr.NUMBER,value:e?parseFloat(qe()):parseInt(qe(),10)}},$=Je("string"),ee='"',re=Xe('"',!1),te=/^[^"]/,ne=Ze(['"'],!0,!1),oe=function(e){return{type:fr.STRING,value:e.join("")}},ue="'",ae=Xe("'",!1),ie=/^[^']/,ce=Ze(["'"],!0,!1),se=Je("array"),le="[",fe=Xe("[",!1),he="]",pe=Xe("]",!1),de=function(e){return{type:fr.ARRAY,value:e}},ve=function(){return{type:fr.ARRAY,value:[]}},ye=Je("dictionary"),me="{",ge=Xe("{",!1),Ae="}",be=Xe("}",!1),xe=function(e){return{type:fr.DICTIONARY,value:e.reduce((e,r)=>(e[r.name]=r.value)&&e,{})}},Ce=function(){return{type:fr.DICTIONARY,value:{}}},we=Je("key-value pair(s)"),Pe=Je("key-value pair"),ke=":",Ee=Xe(":",!1),je=function(e,r){return{name:e,value:r}},Oe=function(e,r){return{key:e.value,value:r}},Re=Je("newline"),_e="\r\n",Ne=Xe("\r\n",!1),Te="\r",Se=Xe("\r",!1),Me="\n",Ie=Xe("\n",!1),Be=Je("optional inline whitespace"),De=/^[ \t]/,Fe=Ze([" ","\t"],!1,!1),Le=0,He=0,Ge=[{line:1,column:1}],Ye=0,ze=[],Ue=0;if("startRule"in t){if(!(t.startRule in u))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=u[t.startRule]}function qe(){return r.substring(He,Le)}function Xe(e,r){return{type:"literal",text:e,ignoreCase:r}}function Ze(e,r,t){return{type:"class",parts:e,inverted:r,ignoreCase:t}}function Je(e){return{type:"other",description:e}}function Ke(e){var t,n=Ge[e];if(n)return n;for(t=e-1;!Ge[t];)t--;for(n={line:(n=Ge[t]).line,column:n.column};t<e;)10===r.charCodeAt(t)?(n.line++,n.column=1):n.column++,t++;return Ge[e]=n,n}function Qe(e,r){var t=Ke(e),n=Ke(r);return{start:{offset:e,line:t.line,column:t.column},end:{offset:r,line:n.line,column:n.column}}}function Ve(e){Le<Ye||(Le>Ye&&(Ye=Le,ze=[]),ze.push(e))}function We(){var e,r,t,n,u,a;for(e=Le,r=[],t=sr();t!==o;)r.push(t),t=sr();if(r!==o)if((t=$e())!==o)if((n=sr())!==o){if(u=[],(a=sr())!==o)for(;a!==o;)u.push(a),a=sr();else u=o;u!==o&&(a=We())!==o?(He=e,e=r=i(t,a)):(Le=e,e=o)}else Le=e,e=o;else Le=e,e=o;else Le=e,e=o;if(e===o){for(e=Le,r=[],t=sr();t!==o;)r.push(t),t=sr();if(r!==o)if((t=$e())!==o){for(n=[],u=sr();u!==o;)n.push(u),u=sr();n!==o?(He=e,e=r=c(t)):(Le=e,e=o)}else Le=e,e=o;else Le=e,e=o}return e}function $e(){var e,r;return e=Le,(r=function e(){var r,t,n,u;return Ue++,r=Le,(t=er())!==o?((n=sr())===o&&(n=null),n!==o&&(u=e())!==o?(He=r,t=i(t,u),r=t):(Le=r,r=o)):(Le=r,r=o),r===o&&(r=Le,(t=er())!==o&&(He=r,t=c(t)),r=t),Ue--,r===o&&(t=o,0===Ue&&Ve(l)),r}())!==o&&(He=e,r=s(r)),e=r}function er(){var e;return(e=tr())===o&&(e=function(){var e,r,t;if(Ue++,e=Le,r=[],(t=rr())!==o)for(;t!==o;)r.push(t),t=rr();else r=o;return r!==o&&(He=e,r=h(r)),Ue--,(e=r)===o&&(r=o,0===Ue&&Ve(f)),e}()),e}function rr(){var e,t,n;if(Ue++,e=Le,r.substr(Le,2)===p?(t=p,Le+=2):(t=o,0===Ue&&Ve(d)),t!==o&&(He=e,t=v()),(e=t)===o){if(e=Le,t=[],y.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(m)),n!==o)for(;n!==o;)t.push(n),y.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(m));else t=o;t!==o&&(He=e,t=g()),e=t}return Ue--,e===o&&(t=o,0===Ue&&Ve(f)),e}function tr(){var e,t,n,u;return Ue++,e=Le,92===r.charCodeAt(Le)?(t=b,Le++):(t=o,0===Ue&&Ve(x)),t!==o&&(n=nr())!==o?((u=function(){var e,t,n,u,a;if(e=Le,40===r.charCodeAt(Le)?(t=_,Le++):(t=o,0===Ue&&Ve(N)),t!==o&&(n=lr())!==o&&(u=ur())!==o&&lr()!==o?(41===r.charCodeAt(Le)?(a=T,Le++):(a=o,0===Ue&&Ve(S)),a!==o?(He=e,t=M(u),e=t):(Le=e,e=o)):(Le=e,e=o),e===o)if(e=Le,40===r.charCodeAt(Le)?(t=_,Le++):(t=o,0===Ue&&Ve(N)),t!==o){if(n=[],I.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(B)),u!==o)for(;u!==o;)n.push(u),I.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(B));else n=o;n!==o?(41===r.charCodeAt(Le)?(u=T,Le++):(u=o,0===Ue&&Ve(S)),u!==o?(He=e,t=D(n),e=t):(Le=e,e=o)):(Le=e,e=o)}else Le=e,e=o;return e}())===o&&(u=null),u!==o?(He=e,e=t=C(n,u)):(Le=e,e=o)):(Le=e,e=o),Ue--,e===o&&(t=o,0===Ue&&Ve(A)),e}function nr(){var e,t,n;return Ue++,e=Le,(t=or())!==o&&(n=nr())!==o?(He=e,e=t=g()):(Le=e,e=o),e===o&&(e=Le,(t=or())!==o?(P.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(k)),n!==o&&nr()!==o?(He=e,e=t=g()):(Le=e,e=o)):(Le=e,e=o),e===o&&(e=Le,(t=or())!==o&&(He=e,t=g()),e=t)),Ue--,e===o&&(t=o,0===Ue&&Ve(w)),e}function or(){var e,t,n;return e=Le,E.test(r.charAt(Le))?(t=r.charAt(Le),Le++):(t=o,0===Ue&&Ve(j)),t!==o?(O.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(R)),n===o&&(n=null),n!==o?e=t=[t,n]:(Le=e,e=o)):(Le=e,e=o),e}function ur(){var e,t,n,u,a;return Ue++,e=Le,(t=ar())!==o&&lr()!==o?(44===r.charCodeAt(Le)?(n=L,Le++):(n=o,0===Ue&&Ve(H)),n!==o&&lr()!==o?((u=sr())===o&&(u=null),u!==o&&lr()!==o&&(a=ur())!==o?(He=e,e=t=i(t,a)):(Le=e,e=o)):(Le=e,e=o)):(Le=e,e=o),e===o&&(e=Le,(t=ar())!==o&&(He=e,t=c(t)),e=t),Ue--,e===o&&(t=o,0===Ue&&Ve(F)),e}function ar(){var e;return(e=function(){var e,t;return Ue++,e=Le,r.substr(Le,4)===U?(t=U,Le+=4):(t=o,0===Ue&&Ve(q)),t===o&&(r.substr(Le,5)===X?(t=X,Le+=5):(t=o,0===Ue&&Ve(Z))),t!==o&&(He=e,t=J()),Ue--,(e=t)===o&&(t=o,0===Ue&&Ve(z)),e}())===o&&(e=function(){var e,t,n,u,a,s;return Ue++,e=Le,123===r.charCodeAt(Le)?(t=me,Le++):(t=o,0===Ue&&Ve(ge)),t!==o&&lr()!==o?((n=sr())===o&&(n=null),n!==o&&lr()!==o&&(u=function e(){var t,n,u,a;return Ue++,t=Le,(n=cr())!==o&&lr()!==o&&(u=sr())!==o&&lr()!==o&&(a=e())!==o?(He=t,n=i(n,a),t=n):(Le=t,t=o),t===o&&(t=Le,(n=cr())!==o&&lr()!==o?(44===r.charCodeAt(Le)?(u=L,Le++):(u=o,0===Ue&&Ve(H)),u!==o&&lr()!==o&&(a=e())!==o?(He=t,n=i(n,a),t=n):(Le=t,t=o)):(Le=t,t=o),t===o&&(t=Le,(n=cr())!==o&&(He=t,n=c(n)),t=n)),Ue--,t===o&&(n=o,0===Ue&&Ve(we)),t}())!==o&&lr()!==o?((a=sr())===o&&(a=null),a!==o&&lr()!==o?(125===r.charCodeAt(Le)?(s=Ae,Le++):(s=o,0===Ue&&Ve(be)),s!==o?(He=e,t=xe(u),e=t):(Le=e,e=o)):(Le=e,e=o)):(Le=e,e=o)):(Le=e,e=o),e===o&&(e=Le,123===r.charCodeAt(Le)?(t=me,Le++):(t=o,0===Ue&&Ve(ge)),t!==o&&lr()!==o?(125===r.charCodeAt(Le)?(n=Ae,Le++):(n=o,0===Ue&&Ve(be)),n!==o?(He=e,t=Ce(),e=t):(Le=e,e=o)):(Le=e,e=o)),Ue--,e===o&&(t=o,0===Ue&&Ve(ye)),e}())===o&&(e=function(){var e,t,n,u,a,i;return Ue++,e=Le,91===r.charCodeAt(Le)?(t=le,Le++):(t=o,0===Ue&&Ve(fe)),t!==o&&lr()!==o?((n=sr())===o&&(n=null),n!==o&&lr()!==o&&(u=ur())!==o&&lr()!==o?((a=sr())===o&&(a=null),a!==o&&lr()!==o?(93===r.charCodeAt(Le)?(i=he,Le++):(i=o,0===Ue&&Ve(pe)),i!==o?(He=e,t=de(u),e=t):(Le=e,e=o)):(Le=e,e=o)):(Le=e,e=o)):(Le=e,e=o),e===o&&(e=Le,91===r.charCodeAt(Le)?(t=le,Le++):(t=o,0===Ue&&Ve(fe)),t!==o&&lr()!==o?(93===r.charCodeAt(Le)?(n=he,Le++):(n=o,0===Ue&&Ve(pe)),n!==o?(He=e,t=ve(),e=t):(Le=e,e=o)):(Le=e,e=o)),Ue--,e===o&&(t=o,0===Ue&&Ve(se)),e}())===o&&(e=tr())===o&&(e=function(){var e,r;return Ue++,e=Le,(r=nr())!==o&&(He=e,r=Y(r)),Ue--,(e=r)===o&&(r=o,0===Ue&&Ve(G)),e}())===o&&(e=function(){var e,t,n,u,a,i;if(Ue++,e=Le,t=[],O.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(R)),n!==o)for(;n!==o;)t.push(n),O.test(r.charAt(Le))?(n=r.charAt(Le),Le++):(n=o,0===Ue&&Ve(R));else t=o;if(t!==o){if(n=Le,46===r.charCodeAt(Le)?(u=Q,Le++):(u=o,0===Ue&&Ve(V)),u!==o){if(a=[],O.test(r.charAt(Le))?(i=r.charAt(Le),Le++):(i=o,0===Ue&&Ve(R)),i!==o)for(;i!==o;)a.push(i),O.test(r.charAt(Le))?(i=r.charAt(Le),Le++):(i=o,0===Ue&&Ve(R));else a=o;a!==o?n=u=[u,a]:(Le=n,n=o)}else Le=n,n=o;n===o&&(n=null),n!==o?(He=e,t=W(n),e=t):(Le=e,e=o)}else Le=e,e=o;return Ue--,e===o&&(t=o,0===Ue&&Ve(K)),e}())===o&&(e=ir()),e}function ir(){var e,t,n,u;if(Ue++,e=Le,34===r.charCodeAt(Le)?(t=ee,Le++):(t=o,0===Ue&&Ve(re)),t!==o){for(n=[],te.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(ne));u!==o;)n.push(u),te.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(ne));n!==o?(34===r.charCodeAt(Le)?(u=ee,Le++):(u=o,0===Ue&&Ve(re)),u!==o?(He=e,e=t=oe(n)):(Le=e,e=o)):(Le=e,e=o)}else Le=e,e=o;if(e===o)if(e=Le,39===r.charCodeAt(Le)?(t=ue,Le++):(t=o,0===Ue&&Ve(ae)),t!==o){for(n=[],ie.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(ce));u!==o;)n.push(u),ie.test(r.charAt(Le))?(u=r.charAt(Le),Le++):(u=o,0===Ue&&Ve(ce));n!==o?(39===r.charCodeAt(Le)?(u=ue,Le++):(u=o,0===Ue&&Ve(ae)),u!==o?(He=e,e=t=oe(n)):(Le=e,e=o)):(Le=e,e=o)}else Le=e,e=o;return Ue--,e===o&&(t=o,0===Ue&&Ve($)),e}function cr(){var e,t,n,u;return Ue++,e=Le,(t=nr())!==o&&lr()!==o?(58===r.charCodeAt(Le)?(n=ke,Le++):(n=o,0===Ue&&Ve(Ee)),n!==o&&lr()!==o&&(u=ar())!==o?(He=e,e=t=je(t,u)):(Le=e,e=o)):(Le=e,e=o),e===o&&(e=Le,(t=ir())!==o&&lr()!==o?(58===r.charCodeAt(Le)?(n=ke,Le++):(n=o,0===Ue&&Ve(Ee)),n!==o&&lr()!==o&&(u=ar())!==o?(He=e,e=t=Oe(t,u)):(Le=e,e=o)):(Le=e,e=o)),Ue--,e===o&&(t=o,0===Ue&&Ve(Pe)),e}function sr(){var e;return Ue++,r.substr(Le,2)===_e?(e=_e,Le+=2):(e=o,0===Ue&&Ve(Ne)),e===o&&(13===r.charCodeAt(Le)?(e=Te,Le++):(e=o,0===Ue&&Ve(Se)),e===o&&(10===r.charCodeAt(Le)?(e=Me,Le++):(e=o,0===Ue&&Ve(Ie)))),Ue--,e===o&&0===Ue&&Ve(Re),e}function lr(){var e,t;for(Ue++,e=[],De.test(r.charAt(Le))?(t=r.charAt(Le),Le++):(t=o,0===Ue&&Ve(Fe));t!==o;)e.push(t),De.test(r.charAt(Le))?(t=r.charAt(Le),Le++):(t=o,0===Ue&&Ve(Fe));return Ue--,e===o&&(t=o,0===Ue&&Ve(Be)),e}const fr={PARAGRAPH:1,COMMAND:2,TEXT:3,BOOLEAN:10,DICTIONARY:11,ARRAY:12,NUMBER:13,STRING:14};if((n=a())!==o&&Le===r.length)return n;throw n!==o&&Le<r.length&&Ve({type:"end"}),function(r,t,n){return new e(e.buildMessage(r,t),r,t,n)}(ze,Ye<r.length?r.charAt(Ye):null,Ye<r.length?Qe(Ye,Ye+1):Qe(Ye,Ye))}}}();function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,r){return e(r={exports:{}},r.exports),r.exports}var u=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,r){function t(){var r=t.__proto__.apply(this,arguments);return Object.assign(r,e.apply(null,arguments)),r}return r=r||Error,Object.setPrototypeOf(t,r),t}r.SubError=n(function(e){return{name:"SubError",message:"SubError "+e.reduce(function(e,r){return e+="\n\n"+r.stack},""),errors:e}},Error),r.IterableError=n(function(e){return{name:"IterableError",message:"expecting an array or an iterable object but got "+(null===e?"null":void 0===e?"undefined":t(e))}},TypeError)});n(u);u.SubError,u.IterableError;var a=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.size=function(e){return Array.isArray(e)?e.length:Object.keys(e).length},r.repeat=function(e,r){for(var t=0;t<e;t++)r(t)},r.toArray=function(e){return Object.keys(e).map(function(r){return e[r]})},r.toBoolean=function(e){return!!e},r.identity=function(e){return e},r.defaults=function(e,r){var t=Object.assign({},r);return Object.keys(e).reduce(function(t,n){return t[n]=void 0===e[n]?r[n]:e[n],t},t)},r.isIterable=function(e){return e&&"function"==typeof e.entries},r.noop=function(){},r.isDefined=function(e){return void 0!==e}});n(a);a.size,a.repeat,a.toArray,a.toBoolean,a.identity,a.defaults,a.isIterable,a.noop,a.isDefined;var i=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(e){return Array.isArray(e)?Promise.all(e):Promise.resolve(e)}(e).then(function(e){return r&&!(0,a.isIterable)(e)?Promise.reject((0,u.IterableError)(e)):e})}});n(i);var c=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.identity;return(0,n.default)(e).then(function(e){return Promise.all(e.map(r))})};var t,n=(t=i)&&t.__esModule?t:{default:t}})),s=o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){return function(t){return t.reduce(function(r,n,o){return r.then(function(r){return e(r,n,o,t)})},Promise.resolve(r))}}});n(s);var l,f=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){return Promise.all(e).then((0,n.default)(function(e,t,n,o){return Promise.resolve(t).then(function(e){return r(e,n,o)}).then(function(r){return e.push(r),e})},[]))};var t,n=(t=s)&&t.__esModule?t:{default:t}})),h=n(o(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r,o){return(0,n.default)(e).then((0,t.default)(r,o))};var t=o(s),n=o(i);function o(e){return e&&e.__esModule?e:{default:e}}}));!function(e){e[e.Paragraph=1]="Paragraph",e[e.Command=2]="Command",e[e.Text=3]="Text",e[e.Block=4]="Block",e[e.Html=5]="Html",e[e.Node=6]="Node",e[e.Boolean=10]="Boolean",e[e.Dictionary=11]="Dictionary",e[e.Array=12]="Array",e[e.Number=13]="Number",e[e.String=14]="String"}(l||(l={}));var p=t,d=function(e,r,t,n){if(void 0===n&&(n=!1),!n&&void 0!==e[r])return console.warn("Command '"+r+"' is already registered. Set overwrite to true, if you need to overwrite the already registered command.");e[r]=t},v={".":!0,",":!0},y=function(e){var r=[],t=e.value.reduce(function(e,t){return t.type===l.Text?v[t.value[0]]?(e.push({type:l.Text,value:t.value[0]+" "}),1!==t.value.length&&r.push({type:l.Text,value:t.value.substr(1)})):r.push(t):(r.length&&(e.push({type:l.Text,value:r.map(function(e){return e.value}).join(" ")}),r.length=0),e.push(t)),e},[]);return r.length&&t.push({type:l.Text,value:r.map(function(e){return e.value}).join(" ")}),{type:e.type,value:t}},m=function(e){return!!e},g=function(t,n){return e(void 0,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,c(t,n)];case 1:return[2,e.sent().flat()]}})})},A=function(t,n){return e(void 0,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,c(t,n)];case 1:return[2,e.sent().flat().filter(m)]}})})},b=function(e){var r,t=!0;return e.reduce(function(e,n){return n.type===l.Paragraph?t=e.push.apply(e,b(n.value))&&!0:(t&&(t=e.push(r={type:l.Paragraph,value:[]})&&!1),r.value.push(n)),e},[]).flat()};return new(function(){function t(){var t=this;this.hooks={prerender:new Array,midrender:new Array,postrender:new Array},this.registeredPackages=new Array,this.commands={},this.preprocessors={},this.baseRenderNode=function(n){return e(t,void 0,void 0,function(){var e,t;return r(this,function(r){switch(r.label){case 0:if("string"==typeof n)return[2,this.text(n)];if(!n.type)return[2,n];switch(n.type){case l.Node:return[3,1];case l.Paragraph:return[3,2];case l.Html:return[3,4];case l.Text:return[3,5];case l.Command:return[3,6]}return[3,9];case 1:return[2,n];case 2:return[4,g(n.value,this.baseRenderNode)];case 3:return(e=r.sent()).length&&e.push(this.htmlLite("div",{class:"meta paragraph-break"})),[2,e];case 4:return[2,this.htmlLite("span",{innerHTML:n.value})];case 5:return[2,document.createTextNode(n.value)];case 6:return[4,this.executeCommand(n.name,n.args)];case 7:return t=[r.sent()].flat().filter(m),[4,g(t,this.baseRenderNode)];case 8:return[2,r.sent()];case 9:return console.error("Unrecognized node",n),[2]}})})},this.executeCommand=function(n,o){return e(t,void 0,void 0,function(){var e,t,u,a,i=this;return r(this,function(r){switch(r.label){case 0:return void 0===this.commands[n]?[3,3]:(t=(e=(a=this.commands)[n]).apply,u=[a],[4,c(o,function(e){return e.type===l.Command?i.executeCommand(e.name,e.args):e})]);case 1:return[4,t.apply(e,u.concat([r.sent()]))];case 2:return[2,r.sent()];case 3:return console.warn("Command '"+n+"' not registered"),[4,this.html("b",{class:"error"},n+"?")];case 4:return[2,r.sent()]}})})},this.executePreprocessor=function(n){return e(t,void 0,void 0,function(){var e,t,o,u;return r(this,function(r){switch(r.label){case 0:return n.type===l.Command&&this.preprocessors[n.name]?[4,(u=this.preprocessors)[n.name].apply(u,n.args)]:[3,3];case 1:return e=[r.sent()].flat().filter(m),[4,g(e,this.executePreprocessor)];case 2:return t=r.sent(),void 0===this.commands[n.name]?[2,t]:[3,5];case 3:return n.type!==l.Paragraph?[3,5]:(o=n,[4,A(n.value,this.executePreprocessor)]);case 4:o.value=r.sent(),r.label=5;case 5:return[2,n]}})})},this.executePreprocessors=function(n){return e(t,void 0,void 0,function(){var t=this;return r(this,function(o){switch(o.label){case 0:return[4,h(n,function(n,o){return e(t,void 0,void 0,function(){var e;return r(this,function(r){switch(r.label){case 0:return[4,A(o.value,this.executePreprocessor)];case 1:return e=r.sent(),n.push.apply(n,b(e)),[2,n]}})})},[])];case 1:return[2,o.sent()]}})})}}return t.trigger=function(e){return e.forEach(function(e){return e()})},t.prototype.registerCommand=function(e,r,t){return d(this.commands,e,r,t)},t.prototype.registerPreprocessor=function(e,r,t){return d(this.preprocessors,e,r,t)},t.prototype.verifyArguments=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=r.map(function(r,t){return{expected:e[t],actual:r.type,index:t}}).filter(function(e){return e.expected!==e.actual});return{ok:0===n.length,invalid:n}},t.prototype.jsArguments=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.map(this.jsArgument)},t.prototype.jsArgument=function(e){var r=this;switch(e.type){case l.Number:case l.String:case l.Boolean:return e.value;case l.Array:return e.value.map(this.jsArgument);case l.Dictionary:return Object.keys(e.value).reduce(function(t,n){return t[n]=r.jsArgument(e.value[n]),t},{})}},t.prototype.parse=function(e){return p.parse(e).map(y)},t.prototype.registerPackage=function(e){var r=this;e.commands&&Object.keys(e.commands).forEach(function(t){return r.registerCommand(t,e.commands[t])}),e.preprocessors&&Object.keys(e.preprocessors).forEach(function(t){return r.registerPreprocessor(t,e.preprocessors[t])}),e.hooks&&(e.hooks.prerender&&this.on("prerender",e.hooks.prerender),e.hooks.postrender&&this.on("postrender",e.hooks.postrender)),e.requires&&e.requires.forEach(function(t){r.registeredPackages.includes(t)||console.warn("Package '"+e.name+"' requires '"+t+"' which has not been registered")}),this.registeredPackages.push(e.name)},t.prototype.render=function(n,o){return e(this,void 0,void 0,function(){var u,a,i,c,s,l,h=this;return r(this,function(p){switch(p.label){case 0:for(;o.firstChild;)o.removeChild(o.firstChild);return u=0,(i=function(){o.appendChild(a=h.htmlLite("section",{id:"page-"+ ++u,class:"sheet","data-page":u})),a.appendChild(h.htmlLite("div",{class:"meta page-start"}))})(),c=function(e){a.appendChild(e),a.scrollHeight>a.clientHeight&&(i(),a.appendChild(e))},t.trigger(this.hooks.prerender),s=this.parse(n).map(y),[4,this.executePreprocessors(s)];case 1:return l=p.sent(),t.trigger(this.hooks.midrender),[4,f(l,function(t){return e(h,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.baseRenderNode(t)];case 1:return[2,e.sent()]}})})})];case 2:return p.sent().forEach(function(e){return e.forEach(c)}),t.trigger(this.hooks.postrender),[2]}})})},t.prototype.text=function(e){return document.createTextNode(e)},t.prototype.htmlLite=function(e,r){for(var t=this,n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var u=document.createElement(e);return Object.keys(r||{}).forEach(function(e){return u.setAttribute(e,r[e])}),n.forEach(function(e){return"string"==typeof e?u.appendChild(t.text(e)):u.appendChild(e)}),u},t.prototype.html=function(t,n){for(var o=[],u=2;u<arguments.length;u++)o[u-2]=arguments[u];return e(this,void 0,void 0,function(){var e,u,a,i;return r(this,function(r){switch(r.label){case 0:e=this.htmlLite(t,n),u=0,r.label=1;case 1:return u<o.length?(i=(a=e).appendChild,[4,this.baseRenderNode(o[u])]):[3,4];case 2:i.apply(a,[r.sent()]),r.label=3;case 3:return u++,[3,1];case 4:return[2,e]}})})},t.prototype.on=function(e,r){this.hooks[e].includes(r)||this.hooks[e].push(r)},t.prototype.off=function(e,r){var t=this.hooks[e].indexOf(r);-1!==t&&this.hooks[e].splice(t,1)},t}())});
//# sourceMappingURL=nxtx.min.js.map
