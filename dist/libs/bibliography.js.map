{"version":3,"file":"bibliography.js","sources":["../../src/libs/bibliography.js"],"sourcesContent":["/*  Bibliography package for nxtx\r\n    requires:\r\n    - basic-formatting (newpage)\r\n    License: MIT */\r\n\r\nconst entries = {};\r\nlet cited = [];\r\n\r\nnxtx.registerCommand('bib-add', (key, entry) => {\r\n    if (!entry || entry.type !== 'dictionary') return console.error('bib-add only must have a dictionary as second argument');\r\n    entries[key.value] = entry.value;\r\n});\r\n\r\nnxtx.registerCommand('cite', (...keys) => {\r\n    const numbers = keys.map(arg => {\r\n        let index = cited.indexOf(arg.value);\r\n        if (index === -1) {\r\n            cited.push(arg.value);\r\n            index = cited.length - 1;\r\n        }\r\n        return index + 1;\r\n    });\r\n    return nxtx.html('a', null, `[${numbers.join(', ')}]`);\r\n});\r\n\r\nconst entryFieldFormatting = {\r\n    author: author => {\r\n        const authors = author.value.split(' and ').map(a => {\r\n            const names = a.split(' ').filter(n => n[0] === n[0].toUpperCase());\r\n            const lastname = names[names.length - 1];\r\n            names.length -= 1;\r\n            const firstnames = names;\r\n            return firstnames.map(n => n[0] + '.').join(' ') + ' ' + lastname;\r\n        }).join(', ');\r\n        return nxtx.html('span', { class: 'bib bib-author' }, authors + '.');\r\n    },\r\n    year: year => nxtx.html('span', { class: 'bib bib-year' }, `(${year.value}).`),\r\n    title: title => nxtx.html('span', { class: 'bib bib-title' }, `“${title.value}”.`),\r\n    url: url => nxtx.html('a', { class: 'bib bib-title', href: url.value, target: '_blank' }, url.value),\r\n    isbn: isbn => nxtx.html('span', { class: 'bib bib-isbn' }, `ISBN: ${isbn.value}.`)\r\n};\r\nnxtx.registerCommand('bib-print', () => {\r\n    const citedEntries = cited.map(e => entries[e] || console.warn(`Bibliography entry '${e}' not found`)).filter(f => !!f);\r\n    if (citedEntries.length === 0) {\r\n        return;\r\n    }\r\n    const mapped = citedEntries.flatMap((entryFields, number) => {\r\n        return nxtx.html('div', { class: 'bib bib-entry' },\r\n            nxtx.html('span', { class: 'bib bib-ordering' }, `[${number + 1}]`),\r\n            ...Object.keys(entryFieldFormatting)\r\n                .filter(k => entryFields[k] !== undefined)\r\n                .map(k => entryFieldFormatting[k](entryFields[k]))\r\n        );\r\n    });\r\n    return {\r\n        type: 'paragraph',\r\n        value: [\r\n            { type: 'command', name: 'newpage', args: [] },\r\n            nxtx.html('h2', { class: 'bibliography' }, 'Bibliography'),\r\n            ...mapped\r\n        ]\r\n    };\r\n});\r\n\r\nnxtx.on('prerender', () => cited = []);"],"names":[],"mappings":"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"}