{"version":3,"file":"bibliography.js","sources":["../../../src/packages/bibliography.js"],"sourcesContent":["/*  Bibliography package for nxtx\r\n    requires:\r\n    - basic-formatting (newpage)\r\n    License: MIT */\r\n\r\nconst entries = {};\r\nlet cited = [];\r\n\r\nconst style = document.createElement(\"style\");\r\nstyle.id = 'bibliography-style-block';\r\ndocument.head.appendChild(style);\r\n\r\n\r\nnxtx.registerCommand('bib-add', (key, entry) => {\r\n    if (!entry || entry.type !== 'dictionary') return console.error('bib-add only must have a dictionary as second argument');\r\n    entries[key.value] = entry.value;\r\n});\r\n\r\nnxtx.registerCommand('cite', async (...args) => {\r\n    const cites = args.flatMap(arg => {\r\n        let index = cited.indexOf(arg.value);\r\n        if (index === -1) {\r\n            cited.push(arg.value);\r\n            index = cited.length - 1;\r\n        }\r\n        const e = nxtx.htmlLite('a', { href: `#---${arg.value}`});\r\n        e.innerText = index + 1;\r\n        return [ e, ', ' ];\r\n    });\r\n    cites.length -= 1;\r\n    return nxtx.html('span', null, '[', ...cites, ']');\r\n});\r\n\r\nconst formatAuthors = author => {\r\n    const authors = author.value.split(' and ').map(a => {\r\n        const split = a.split(',');\r\n        if (split.length > 1) a = split[1].trim() + ' ' + split[0];\r\n        const names = a.split(' ').filter(n => n[0] === n[0].toUpperCase());\r\n        const lastname = names[names.length - 1];\r\n        names.length -= 1;\r\n        return names.map(n => n[0] + '.').join(' ') + ' ' + lastname;\r\n    }).join(', ');\r\n    return nxtx.html('span', { class: 'bib bib-author' }, authors + '.');\r\n};\r\n\r\nconst entryFieldFormatting = {\r\n    author: formatAuthors,\r\n    year: year => nxtx.html('span', { class: 'bib bib-year' }, `(${year.value}).`),\r\n    title: title => nxtx.html('span', { class: 'bib bib-title' }, `“${title.value}”.`),\r\n    url: url => nxtx.html('a', { class: 'bib bib-url', href: url.value, target: '_blank' }, url.value),\r\n    isbn: isbn => nxtx.html('span', { class: 'bib bib-isbn' }, `ISBN: ${isbn.value}.`)\r\n};\r\nnxtx.registerCommand('bib-print', async () => {\r\n    const citedEntries = cited.map(e => entries[e] || console.warn(`Bibliography entry '${e}' not found`)).filter(f => !!f);\r\n    if (citedEntries.length === 0) {\r\n        return;\r\n    }\r\n    const mapped = citedEntries.map((entryFields, number) => nxtx.html('div', { id: `---${cited[number]}`, class: 'bib bib-entry'},\r\n            nxtx.html('span', { class: 'bib bib-ordering'}, `[${number + 1}]`),\r\n            ...Object.keys(entryFieldFormatting)\r\n                .filter(k => entryFields[k] !== undefined)\r\n                .map(k => entryFieldFormatting[k](entryFields[k]))\r\n    ));\r\n    return [\r\n        { type: 'command', name: 'newpage', args: [] },\r\n        nxtx.html('h2', { class: 'bibliography' }, 'Bibliography'),\r\n        ...mapped\r\n    ];\r\n});\r\n\r\nnxtx.on('prerender', () => cited = []);"],"names":[],"mappings":"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"}