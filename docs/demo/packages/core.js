var nxtx_core=function(){"use strict";const e=document.createElement("style");e.id="basic-formatting-style-block",document.head.appendChild(e),e.sheet.insertRule(".page-break { height: 0 }",0),e.sheet.insertRule(".meta ~ .page-break:not(:last-child) { height: 100% }",1),e.sheet.insertRule(".paragraph-break { height: 0 }",2),e.sheet.insertRule(".meta ~ .paragraph-break:not(:last-child) { height: 1.2em }",3);const t={name:"basic-formatting",commands:{"text:it":e=>nxtx.html("i",null,e.value),"text:bf":e=>nxtx.html("b",null,e.value),"text:tt":e=>nxtx.html("code",null,e.value),dquote:e=>`“${e.value}”`,break:()=>nxtx.htmlLite("div",{class:"meta",style:"height: 1.5em"}),pagebreak:()=>nxtx.htmlLite("div",{class:"meta page-break"}),title:e=>(document.title=e.value)&&!1}};nxtx&&Object.keys(t.commands).forEach(e=>nxtx.registerCommand(e,t.commands[e]));const s=document.createElement("style");s.id="layout-style-block",document.head.appendChild(s);const a=(e,t)=>{s.sheet.deleteRule?s.sheet.deleteRule(t):s.sheet.removeRule&&s.sheet.removeRule(t),s.sheet.insertRule(e,t)},o={all:e=>{a(`.sheet { padding: ${e} }`,1)},left:e=>{a(`.sheet { padding-left: ${e} }`,1)},top:e=>{a(`.sheet { padding-top: ${e} }`,1)},right:e=>{a(`.sheet { padding-right: ${e} }`,1)},bottom:e=>{a(`.sheet { padding-bottom: ${e} }`,1)},vertical:e=>{a(`.sheet { padding-top: ${e}; padding-bottom: ${e} }`,1)},horizontal:e=>{a(`.sheet { padding-left: ${e}; padding-right: ${e} }`,1)},"head-separator":e=>{s.sheet.insertRule(`header { margin-bottom: ${e}`,2)},"foot-skip":e=>{s.sheet.insertRule(`footer { margin-top: ${e}`,3)}};s.sheet.insertRule("@page { size: A4 }",0),s.sheet.insertRule(".sheet { padding: 2cm }",1),s.sheet.insertRule("header { height: 3cm }",2),s.sheet.insertRule("footer { height: 3cm }",3);const n={name:"layout",commands:{"set-paper-size":e=>a(`@page { size: ${e} }`,0),"set-header":e=>a(`header {height: ${e}mm`,2),"set-footer":e=>a(`footer {height: ${e}mm`,3)},preprocessors:{"set-margin":e=>Object.keys(e.value).forEach(t=>o[t]((e=>(console.log(e),e.type!==nxtx.TYPES.NUMBER?e.value:e.value+"mm"))(e.value[t])))}};nxtx&&(Object.keys(n.commands).forEach(e=>nxtx.registerCommand(e,n.commands[e])),Object.keys(n.preprocessors).forEach(e=>nxtx.registerPreprocessor(e,n.preprocessors[e])));let r={documents:{},packages:[]};const l={name:"loading",preprocessors:{"load:document":async e=>{const t=e.value.toString(),s=".nxtx"!==t.substr(t.length-5).toLowerCase()?`${t}.nxtx`:t,a=await fetch(s);if(!a.ok)return console.error(`NxTx document ${s} not found`);const o=a.headers.get("last-modified"),n=r.documents[s];if(o&&n&&n.lastModified===o)return console.log("using cached",s),r.documents[s].nodes;const l=await a.text(),d=nxtx.parse(l);return o&&(r.documents[s]={lastModified:o,nodes:d}),d},"load:package":e=>new Promise((t,s)=>{if(r.packages[e.value])return t();r.packages[e.value]=!0;const a=document.createElement("script");a.src=e.value,a.async=!0,a.onreadystatechange=a.onload=()=>{t.done||a.readyState&&!/loaded|complete/.test(a.readyState)||(t.done=!0,t())},document.head.appendChild(a)})}};nxtx&&Object.keys(l.preprocessors).forEach(e=>nxtx.registerPreprocessor(e,l.preprocessors[e]));const d=document.createElement("style");d.id="styling-style-block",document.head.appendChild(d);const i={name:"styling",commands:{"add-css-rule":(e,t=1)=>d.sheet.insertRule(e.value,t),"set-root-style":(e,...t)=>document.querySelector(".nxtx-root").style.setProperty(e,t.map(e=>e.value).join(", ")),"set-font-family":(...e)=>({type:nxtx.TYPE.COMMAND,name:"set-root-style",args:["font-family",...e]}),"set-google-font-family":async(...e)=>{const t={rel:"stylesheet",href:`https://fonts.googleapis.com/css?family=${e[0].value}&display=swap`,id:"link-gfont-"+e[0].value};if(!document.getElementById(t.id)){const e=await nxtx.html("link",t);document.head.appendChild(e)}return{type:nxtx.TYPE.COMMAND,name:"set-font-family",args:e}}}};return nxtx&&Object.keys(i.commands).forEach(e=>nxtx.registerCommand(e,i.commands[e])),{formatting:t,layout:n,loading:l,styling:i}}();
//# sourceMappingURL=core.js.map
