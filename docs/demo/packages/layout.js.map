{"version":3,"file":"layout.js","sources":["../../../src/packages/layout.js"],"sourcesContent":["/*  Layout package for nxtx\r\n    Author: Thomas Gwynfryn McCollin\r\n    License: MIT */\r\n\r\nconst style = document.createElement(\"style\");\r\nstyle.id = 'layout-style-block';\r\ndocument.head.appendChild(style);\r\n\r\nconst parse = argNode => {\r\n    console.log(argNode);\r\n    if (argNode.type !== nxtx.TYPES.NUMBER) return argNode.value;\r\n    return argNode.value + 'mm';\r\n};\r\n\r\nconst replaceRule = (newRule, ruleIndex) => {\r\n    if (style.sheet.deleteRule) style.sheet.deleteRule(ruleIndex);\r\n    else if (style.sheet.removeRule) style.sheet.removeRule(ruleIndex);\r\n    style.sheet.insertRule(newRule, ruleIndex);\r\n};\r\n\r\nconst marginFormatters = {\r\n    all: value => { replaceRule(`.sheet { padding: ${value} }`, 1) },\r\n    left: value => { replaceRule(`.sheet { padding-left: ${value} }`, 1) },\r\n    top: value => { replaceRule(`.sheet { padding-top: ${value} }`, 1) },\r\n    right: value => { replaceRule(`.sheet { padding-right: ${value} }`, 1) },\r\n    bottom: value => { replaceRule(`.sheet { padding-bottom: ${value} }`, 1) },\r\n    vertical: value => { replaceRule(`.sheet { padding-top: ${value}; padding-bottom: ${value} }`, 1) },\r\n    horizontal: value => { replaceRule(`.sheet { padding-left: ${value}; padding-right: ${value} }`, 1) },\r\n\r\n    'head-separator': value => { style.sheet.insertRule(`header { margin-bottom: ${value}`, 2) },\r\n    'foot-skip': value => { style.sheet.insertRule(`footer { margin-top: ${value}`, 3) },\r\n};\r\n\r\n// Default\r\nstyle.sheet.insertRule('@page { size: A4 }', 0);\r\nstyle.sheet.insertRule(`.sheet { padding: 2cm }`, 1);\r\nstyle.sheet.insertRule('header { height: 3cm }', 2);\r\nstyle.sheet.insertRule('footer { height: 3cm }', 3);\r\n\r\nconst pkg = {\r\n    name: 'layout',\r\n    commands: {\r\n        'set-paper-size': paperSizeNode => replaceRule(`@page { size: ${paperSizeNode} }`, 0),\r\n        'set-header': heightNode => replaceRule(`header {height: ${heightNode}mm`, 2),\r\n        'set-footer': heightNode => replaceRule(`footer {height: ${heightNode}mm`, 3)\r\n    },\r\n    preprocessors: {\r\n        'set-margin': dictNode => Object.keys(dictNode.value).forEach(key => marginFormatters[key](parse(dictNode.value[key])))\r\n    }\r\n};\r\n\r\nif (nxtx) {\r\n    Object.keys(pkg.commands).forEach(name => nxtx.registerCommand(name, pkg.commands[name]));\r\n    Object.keys(pkg.preprocessors).forEach(name => nxtx.registerPreprocessor(name, pkg.preprocessors[name]));\r\n}\r\n\r\nexport default pkg;"],"names":["style","document","createElement","id","head","appendChild","replaceRule","newRule","ruleIndex","sheet","deleteRule","removeRule","insertRule","marginFormatters","all","value","left","top","right","bottom","vertical","horizontal","head-separator","foot-skip","pkg","name","commands","set-paper-size","paperSizeNode","set-header","heightNode","set-footer","preprocessors","set-margin","dictNode","Object","keys","forEach","key","argNode","console","log","type","nxtx","TYPES","NUMBER","parse","registerCommand","registerPreprocessor"],"mappings":"wCAIA,MAAMA,EAAQC,SAASC,cAAc,SACrCF,EAAMG,GAAK,qBACXF,SAASG,KAAKC,YAAYL,GAE1B,MAMMM,EAAc,CAACC,EAASC,KACtBR,EAAMS,MAAMC,WAAYV,EAAMS,MAAMC,WAAWF,GAC1CR,EAAMS,MAAME,YAAYX,EAAMS,MAAME,WAAWH,GACxDR,EAAMS,MAAMG,WAAWL,EAASC,IAG9BK,EAAmB,CACrBC,IAAKC,IAAWT,uBAAiCS,MAAW,IAC5DC,KAAMD,IAAWT,4BAAsCS,MAAW,IAClEE,IAAKF,IAAWT,2BAAqCS,MAAW,IAChEG,MAAOH,IAAWT,6BAAuCS,MAAW,IACpEI,OAAQJ,IAAWT,8BAAwCS,MAAW,IACtEK,SAAUL,IAAWT,2BAAqCS,sBAA0BA,MAAW,IAC/FM,WAAYN,IAAWT,4BAAsCS,qBAAyBA,MAAW,IAEjGO,iBAAkBP,IAAWf,EAAMS,MAAMG,sCAAsCG,IAAS,IACxFQ,YAAaR,IAAWf,EAAMS,MAAMG,mCAAmCG,IAAS,KAIpFf,EAAMS,MAAMG,WAAW,qBAAsB,GAC7CZ,EAAMS,MAAMG,WAAW,0BAA2B,GAClDZ,EAAMS,MAAMG,WAAW,yBAA0B,GACjDZ,EAAMS,MAAMG,WAAW,yBAA0B,GAEjD,MAAMY,EAAM,CACRC,KAAM,SACNC,SAAU,CACNC,iBAAkBC,GAAiBtB,mBAA6BsB,MAAmB,GACnFC,aAAcC,GAAcxB,qBAA+BwB,MAAgB,GAC3EC,aAAcD,GAAcxB,qBAA+BwB,MAAgB,IAE/EE,cAAe,CACXC,aAAcC,GAAYC,OAAOC,KAAKF,EAASnB,OAAOsB,QAAQC,GAAOzB,EAAiByB,GAvChFC,CAAAA,IACVC,QAAQC,IAAIF,GACRA,EAAQG,OAASC,KAAKC,MAAMC,OAAeN,EAAQxB,MAChDwB,EAAQxB,MAAQ,MAoCwE+B,CAAMZ,EAASnB,MAAMuB,eAIpHK,OACAR,OAAOC,KAAKZ,EAAIE,UAAUW,QAAQZ,GAAQkB,KAAKI,gBAAgBtB,EAAMD,EAAIE,SAASD,KAClFU,OAAOC,KAAKZ,EAAIQ,eAAeK,QAAQZ,GAAQkB,KAAKK,qBAAqBvB,EAAMD,EAAIQ,cAAcP"}