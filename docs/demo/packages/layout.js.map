{"version":3,"file":"layout.js","sources":["../../../src/packages/layout.js"],"sourcesContent":["/*  Layout package for nxtx\r\n    Author: Thomas Gwynfryn McCollin\r\n    License: MIT */\r\n\r\nconst style = document.createElement(\"style\");\r\nstyle.id = 'layout-style-block';\r\ndocument.head.appendChild(style);\r\n\r\nconst parse = argNode => {\r\n    console.log(argNode);\r\n    if (argNode.type !== 'number') return argNode.value;\r\n    return argNode.value + 'mm';\r\n};\r\n\r\nconst replaceRule = (newRule, ruleIndex) => {\r\n    if (style.sheet.deleteRule) style.sheet.deleteRule(ruleIndex);\r\n    else if (style.sheet.removeRule) style.sheet.removeRule(ruleIndex);\r\n    style.sheet.insertRule(newRule, ruleIndex);\r\n};\r\n\r\nconst marginFormatters = {\r\n    all: value => { replaceRule(`.sheet { padding: ${value} }`, 1) },\r\n    left: value => { replaceRule(`.sheet { padding-left: ${value} }`, 1) },\r\n    top: value => { replaceRule(`.sheet { padding-top: ${value} }`, 1) },\r\n    right: value => { replaceRule(`.sheet { padding-right: ${value} }`, 1) },\r\n    bottom: value => { replaceRule(`.sheet { padding-bottom: ${value} }`, 1) },\r\n    vertical: value => { replaceRule(`.sheet { padding-top: ${value}; padding-bottom: ${value} }`, 1) },\r\n    horizontal: value => { replaceRule(`.sheet { padding-left: ${value}; padding-right: ${value} }`, 1) },\r\n\r\n    'head-separator': value => { style.sheet.insertRule(`header { margin-bottom: ${value}`, 2) },\r\n    'foot-skip': value => { style.sheet.insertRule(`footer { margin-top: ${value}`, 3) },\r\n};\r\n\r\n// Default\r\nstyle.sheet.insertRule('@page { size: A4 }', 0);\r\nstyle.sheet.insertRule(`.sheet { padding: 2cm }`, 1);\r\nstyle.sheet.insertRule('header { height: 3cm }', 2);\r\nstyle.sheet.insertRule('footer { height: 3cm }', 3);\r\n\r\nconst pkg = {\r\n    name: 'layout',\r\n    commands: {\r\n        'set-paper-size': paperSizeNode => replaceRule(`@page { size: ${paperSizeNode} }`, 0),\r\n        'set-header': heightNode => replaceRule(`header {height: ${heightNode}mm`, 2),\r\n        'set-footer': heightNode => replaceRule(`footer {height: ${heightNode}mm`, 3)\r\n    },\r\n    preprocessors: {\r\n        'set-margin': dictNode => Object.keys(dictNode.value).forEach(key => marginFormatters[key](parse(dictNode.value[key])))\r\n    }\r\n};\r\n\r\nif (nxtx) {\r\n    Object.keys(pkg.commands).forEach(name => nxtx.registerCommand(name, pkg.commands[name]));\r\n    Object.keys(pkg.preprocessors).forEach(name => nxtx.registerPreprocessor(name, pkg.preprocessors[name]));\r\n}\r\n\r\nexport default pkg;"],"names":[],"mappings":"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"}