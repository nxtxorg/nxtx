{"version":3,"file":"list-of-contents.js","sources":["../../../src/packages/list-of-contents.js"],"sourcesContent":["/*  List of contents; Chapter, section etc. package for nxtx\r\n    License: MIT */\r\n\r\nlet baseNumbering = {};\r\nlet numbering = {};\r\nlet parts = [];\r\nlet refs = {};\r\n\r\nconst registerPart = (type, element) => {\r\n    baseNumbering[type] = 0;\r\n    numbering = { ...baseNumbering };\r\n    nxtx.registerCommand(type, content => {\r\n        numbering[type] += 1;\r\n        resetChildren(type);\r\n        parts.push({ type, title: content.value, numbering: { ...numbering } });\r\n        return nxtx.html(element, null, content.value);\r\n    });\r\n};\r\n\r\n[   // Ordering matters\r\n    ['chapter', 'h1'],\r\n    ['section', 'h3'],\r\n    ['subsection', 'h4'],\r\n].map(arr => registerPart(...arr));\r\n\r\nnxtx.registerCommand('label', ref => {\r\n    refs[ref.value] = parts.length && parts[parts.length - 1];\r\n    return nxtx.html('span', {id: '--' + ref.value, 'data-label': ref.value});\r\n});\r\n\r\nconst resetChildren = type => {\r\n    const types = Object.keys(numbering);\r\n    let reset = false;\r\n    for (let i = 0; i < types.length; i++) {\r\n        if (reset) numbering[types[i]] = 0;\r\n        else if (types[i] === type) reset = true;\r\n    }\r\n};\r\nconst capitalizeStr = str => str[0].toUpperCase() + str.substr(1);\r\nconst formatPart = (ref, capitalize) => {\r\n    const part = refs[ref];\r\n    if (!part) {\r\n        console.warn(`Label '${ref}' has not been referenced`);\r\n        return nxtx.html('b', { class: \"warning\" }, `${ref}`);\r\n    }\r\n    let result = '';\r\n    switch (part.type) {\r\n        case 'chapter':\r\n            result = `chapter ${part.numbering.chapter}`;\r\n            break;\r\n        case 'section':\r\n            result = `section ${part.numbering.chapter}.${part.numbering.section}`;\r\n            break;\r\n        case 'subsection':\r\n            result = `section ${part.numbering.chapter}.${part.numbering.section}.${part.numbering.subsection}`;\r\n            break;\r\n    }\r\n    return capitalize ? capitalizeStr(result) : result;\r\n};\r\nnxtx.registerCommand('ref', ref => {\r\n    return nxtx.html('a', {href: `#--${ref.value}`, 'data-ref': ref.value}, formatPart(ref.value, false));\r\n});\r\nnxtx.registerCommand('Ref', ref => {\r\n    return nxtx.html('a', {href: `#--${ref.value}`, 'data-ref': ref.value}, formatPart(ref.value, true));\r\n});\r\n\r\nnxtx.on('postrender', () => {\r\n    numbering = { ...baseNumbering };\r\n    parts = [];\r\n    refs = {};\r\n});"],"names":[],"mappings":"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"}