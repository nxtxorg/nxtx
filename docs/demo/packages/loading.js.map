{"version":3,"file":"loading.js","sources":["../../../src/packages/loading.js"],"sourcesContent":["\r\nlet loaded = {\r\n    documents: {},\r\n    packages: []\r\n};\r\n\r\nnxtx.registerCommand('load:document', async nameNode => {\r\n    const name = nameNode.value.toString();\r\n    const filename = (name.substr(name.length - 5).toLowerCase() !== '.nxtx') ? `${name}.nxtx` : name;\r\n    const response = await fetch(filename);\r\n    if (!response.ok) return console.error(`NxTx document ${filename} not found`);\r\n\r\n    const lastModified = response.headers.get('last-modified');\r\n    const cached = loaded.documents[filename];\r\n    if (lastModified && cached && cached.lastModified === lastModified) {\r\n        console.log('using cached', filename);\r\n        return loaded.documents[filename].nodes;\r\n    }\r\n\r\n    const content = await response.text();\r\n    const nodes = nxtx.parse(content);\r\n    if (lastModified) {\r\n        loaded.documents[filename] = { lastModified, nodes };\r\n    }\r\n    return nodes;\r\n});\r\n\r\nnxtx.registerCommand('load:package', srcNode => new Promise((acc, rej) => {\r\n    if (loaded.packages[srcNode.value])\r\n        return acc();\r\n    loaded.packages[srcNode.value] = true;\r\n    const script = document.createElement('script');\r\n    script.src = srcNode.value;\r\n    script.async = true;\r\n    script.onreadystatechange = script.onload = () => {\r\n        if (!acc.done && (!script.readyState || /loaded|complete/.test(script.readyState))) {\r\n            acc.done = true;\r\n            acc();\r\n        }\r\n    };\r\n    document.head.appendChild(script);\r\n}));"],"names":[],"mappings":";;;IACA,IAAI,MAAM,GAAG;IACb,IAAI,SAAS,EAAE,EAAE;IACjB,IAAI,QAAQ,EAAE,EAAE;IAChB,CAAC,CAAC;;IAEF,IAAI,CAAC,eAAe,CAAC,eAAe,EAAE,MAAM,QAAQ,IAAI;IACxD,IAAI,MAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;IAC3C,IAAI,MAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,WAAW,EAAE,KAAK,OAAO,IAAI,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;IACtG,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,QAAQ,CAAC,CAAC;IAC3C,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,OAAO,OAAO,CAAC,KAAK,CAAC,CAAC,cAAc,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;;IAElF,IAAI,MAAM,YAAY,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IAC/D,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;IAC9C,IAAI,IAAI,YAAY,IAAI,MAAM,IAAI,MAAM,CAAC,YAAY,KAAK,YAAY,EAAE;IACxE,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;IAC9C,QAAQ,OAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC;IAChD,KAAK;;IAEL,IAAI,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;IAC1C,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IACtC,IAAI,IAAI,YAAY,EAAE;IACtB,QAAQ,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC;IAC7D,KAAK;IACL,IAAI,OAAO,KAAK,CAAC;IACjB,CAAC,CAAC,CAAC;;IAEH,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,OAAO,IAAI,IAAI,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,KAAK;IAC1E,IAAI,IAAI,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;IACtC,QAAQ,OAAO,GAAG,EAAE,CAAC;IACrB,IAAI,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;IAC1C,IAAI,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IACpD,IAAI,MAAM,CAAC,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC;IAC/B,IAAI,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;IACxB,IAAI,MAAM,CAAC,kBAAkB,GAAG,MAAM,CAAC,MAAM,GAAG,MAAM;IACtD,QAAQ,IAAI,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,UAAU,IAAI,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE;IAC5F,YAAY,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC;IAC5B,YAAY,GAAG,EAAE,CAAC;IAClB,SAAS;IACT,KAAK,CAAC;IACN,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;IACtC,CAAC,CAAC,CAAC;;;;"}