!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).nxtx={})}(this,function(e){"use strict";var t=function(){function e(t,r,n,a){this.message=t,this.expected=r,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?u(e.parts[t][0])+"-"+u(e.parts[t][1]):u(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function u(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}return"Expected "+function(e){var t,n,a,u=new Array(e.length);for(t=0;t<e.length;t++)u[t]=(a=e[t],r[a.type](a));if(u.sort(),u.length>0){for(t=1,n=1;t<u.length;t++)u[t-1]!==u[t]&&(u[n]=u[t],n++);u.length=n}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,a={},u={Paragraphs:$e},o=$e,c=function(e,t){return[e,...t]},i=function(e){return[e]},l=function(e){return{type:ut.PARAGRAPH,value:e}},s=Be("paragraph"),f=Be("text"),p=function(e){return{type:ut.TEXT,value:e.join("")}},h="\\\\",d=Xe("\\\\",!1),A=function(){return"\\"},v=/^[^\r\n\\]/,y=Ye(["\r","\n","\\"],!0,!1),g=function(){return Fe()},m=Be("command"),C="\\",b=Xe("\\",!1),x=function(e,t){return{type:ut.COMMAND,name:e,args:t||[]}},E=Be("command name"),R=/^[_:\-]/,T=Ye(["_",":","-"],!1,!1),w=/^[a-zA-Z!#-&*-+\--\/;-@]/,O=Ye([["a","z"],["A","Z"],"!",["#","&"],["*","+"],["-","/"],[";","@"]],!1,!1),P=/^[0-9]/,M=Ye([["0","9"]],!1,!1),j="(",N=Xe("(",!1),I=")",S=Xe(")",!1),_=function(e){return e},D=/^[^)]/,k=Ye([")"],!0,!1),G=function(e){return[{type:ut.STRING,value:e.join("")}]},H=Be("command arguments"),F=",",X=Xe(",",!1),Y=Be("name"),B=function(e){return{type:ut.STRING,value:e}},L=Be("number"),z=".",U=Xe(".",!1),$=function(e){return{type:ut.NUMBER,value:e?parseFloat(Fe()):parseInt(Fe(),10)}},K=Be("string"),Z='"',q=Xe('"',!1),J=/^[^"]/,Q=Ye(['"'],!0,!1),V=function(e){return{type:ut.STRING,value:e.join("")}},W="'",ee=Xe("'",!1),te=/^[^']/,re=Ye(["'"],!0,!1),ne=Be("array"),ae="[",ue=Xe("[",!1),oe="]",ce=Xe("]",!1),ie=function(e){return{type:ut.ARRAY,value:e}},le=function(){return{type:ut.ARRAY,value:[]}},se=Be("dictionary"),fe="{",pe=Xe("{",!1),he="}",de=Xe("}",!1),Ae=function(e){return{type:ut.DICTIONARY,value:e.reduce((e,t)=>(e[t.name]=t.value)&&e,{})}},ve=function(){return{type:ut.DICTIONARY,value:{}}},ye=Be("key-value pair(s)"),ge=Be("key-value pair"),me=":",Ce=Xe(":",!1),be=function(e,t){return{name:e,value:t}},xe=function(e,t){return{key:e.value,value:t}},Ee=Be("newline"),Re="\r\n",Te=Xe("\r\n",!1),we="\r",Oe=Xe("\r",!1),Pe="\n",Me=Xe("\n",!1),je=Be("optional inline whitespace"),Ne=/^[ \t]/,Ie=Ye([" ","\t"],!1,!1),Se=0,_e=0,De=[{line:1,column:1}],ke=0,Ge=[],He=0;if("startRule"in r){if(!(r.startRule in u))throw new Error("Can't start parsing from rule \""+r.startRule+'".');o=u[r.startRule]}function Fe(){return t.substring(_e,Se)}function Xe(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ye(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Be(e){return{type:"other",description:e}}function Le(e){var r,n=De[e];if(n)return n;for(r=e-1;!De[r];)r--;for(n={line:(n=De[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return De[e]=n,n}function ze(e,t){var r=Le(e),n=Le(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Ue(e){Se<ke||(Se>ke&&(ke=Se,Ge=[]),Ge.push(e))}function $e(){var e,t,r,n,u,o;for(e=Se,t=[],r=nt();r!==a;)t.push(r),r=nt();if(t!==a)if((r=Ke())!==a)if((n=nt())!==a){if(u=[],(o=nt())!==a)for(;o!==a;)u.push(o),o=nt();else u=a;u!==a&&(o=$e())!==a?(_e=e,e=t=c(r,o)):(Se=e,e=a)}else Se=e,e=a;else Se=e,e=a;else Se=e,e=a;if(e===a){for(e=Se,t=[],r=nt();r!==a;)t.push(r),r=nt();if(t!==a)if((r=Ke())!==a){for(n=[],u=nt();u!==a;)n.push(u),u=nt();n!==a?(_e=e,e=t=i(r)):(Se=e,e=a)}else Se=e,e=a;else Se=e,e=a}return e}function Ke(){var e,t;return e=Se,(t=function e(){var t,r,n,u;return He++,t=Se,(r=Ze())!==a?((n=nt())===a&&(n=null),n!==a&&(u=e())!==a?(_e=t,r=c(r,u),t=r):(Se=t,t=a)):(Se=t,t=a),t===a&&(t=Se,(r=Ze())!==a&&(_e=t,r=i(r)),t=r),He--,t===a&&(r=a,0===He&&Ue(s)),t}())!==a&&(_e=e,t=l(t)),e=t}function Ze(){var e;return(e=Je())===a&&(e=function(){var e,t,r;if(He++,e=Se,t=[],(r=qe())!==a)for(;r!==a;)t.push(r),r=qe();else t=a;return t!==a&&(_e=e,t=p(t)),He--,(e=t)===a&&(t=a,0===He&&Ue(f)),e}()),e}function qe(){var e,r,n;if(He++,e=Se,t.substr(Se,2)===h?(r=h,Se+=2):(r=a,0===He&&Ue(d)),r!==a&&(_e=e,r=A()),(e=r)===a){if(e=Se,r=[],v.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(y)),n!==a)for(;n!==a;)r.push(n),v.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(y));else r=a;r!==a&&(_e=e,r=g()),e=r}return He--,e===a&&(r=a,0===He&&Ue(f)),e}function Je(){var e,r,n,u;return He++,e=Se,92===t.charCodeAt(Se)?(r=C,Se++):(r=a,0===He&&Ue(b)),r!==a&&(n=Qe())!==a?((u=function(){var e,r,n,u,o;if(e=Se,40===t.charCodeAt(Se)?(r=j,Se++):(r=a,0===He&&Ue(N)),r!==a&&(n=at())!==a&&(u=We())!==a&&at()!==a?(41===t.charCodeAt(Se)?(o=I,Se++):(o=a,0===He&&Ue(S)),o!==a?(_e=e,r=_(u),e=r):(Se=e,e=a)):(Se=e,e=a),e===a)if(e=Se,40===t.charCodeAt(Se)?(r=j,Se++):(r=a,0===He&&Ue(N)),r!==a){if(n=[],D.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(k)),u!==a)for(;u!==a;)n.push(u),D.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(k));else n=a;n!==a?(41===t.charCodeAt(Se)?(u=I,Se++):(u=a,0===He&&Ue(S)),u!==a?(_e=e,r=G(n),e=r):(Se=e,e=a)):(Se=e,e=a)}else Se=e,e=a;return e}())===a&&(u=null),u!==a?(_e=e,e=r=x(n,u)):(Se=e,e=a)):(Se=e,e=a),He--,e===a&&(r=a,0===He&&Ue(m)),e}function Qe(){var e,r,n;return He++,e=Se,(r=Ve())!==a&&(n=Qe())!==a?(_e=e,e=r=g()):(Se=e,e=a),e===a&&(e=Se,(r=Ve())!==a?(R.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(T)),n!==a&&Qe()!==a?(_e=e,e=r=g()):(Se=e,e=a)):(Se=e,e=a),e===a&&(e=Se,(r=Ve())!==a&&(_e=e,r=g()),e=r)),He--,e===a&&(r=a,0===He&&Ue(E)),e}function Ve(){var e,r,n;return e=Se,w.test(t.charAt(Se))?(r=t.charAt(Se),Se++):(r=a,0===He&&Ue(O)),r!==a?(P.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(M)),n===a&&(n=null),n!==a?e=r=[r,n]:(Se=e,e=a)):(Se=e,e=a),e}function We(){var e,r,n,u,o;return He++,e=Se,(r=et())!==a&&at()!==a?(44===t.charCodeAt(Se)?(n=F,Se++):(n=a,0===He&&Ue(X)),n!==a&&at()!==a?((u=nt())===a&&(u=null),u!==a&&at()!==a&&(o=We())!==a?(_e=e,e=r=c(r,o)):(Se=e,e=a)):(Se=e,e=a)):(Se=e,e=a),e===a&&(e=Se,(r=et())!==a&&(_e=e,r=i(r)),e=r),He--,e===a&&(r=a,0===He&&Ue(H)),e}function et(){var e;return(e=function(){var e,r,n,u,o,l;return He++,e=Se,123===t.charCodeAt(Se)?(r=fe,Se++):(r=a,0===He&&Ue(pe)),r!==a&&at()!==a?((n=nt())===a&&(n=null),n!==a&&at()!==a&&(u=function e(){var r,n,u,o;return He++,r=Se,(n=rt())!==a&&at()!==a&&(u=nt())!==a&&at()!==a&&(o=e())!==a?(_e=r,n=c(n,o),r=n):(Se=r,r=a),r===a&&(r=Se,(n=rt())!==a&&at()!==a?(44===t.charCodeAt(Se)?(u=F,Se++):(u=a,0===He&&Ue(X)),u!==a&&at()!==a&&(o=e())!==a?(_e=r,n=c(n,o),r=n):(Se=r,r=a)):(Se=r,r=a),r===a&&(r=Se,(n=rt())!==a&&(_e=r,n=i(n)),r=n)),He--,r===a&&(n=a,0===He&&Ue(ye)),r}())!==a&&at()!==a?((o=nt())===a&&(o=null),o!==a&&at()!==a?(125===t.charCodeAt(Se)?(l=he,Se++):(l=a,0===He&&Ue(de)),l!==a?(_e=e,r=Ae(u),e=r):(Se=e,e=a)):(Se=e,e=a)):(Se=e,e=a)):(Se=e,e=a),e===a&&(e=Se,123===t.charCodeAt(Se)?(r=fe,Se++):(r=a,0===He&&Ue(pe)),r!==a&&at()!==a?(125===t.charCodeAt(Se)?(n=he,Se++):(n=a,0===He&&Ue(de)),n!==a?(_e=e,r=ve(),e=r):(Se=e,e=a)):(Se=e,e=a)),He--,e===a&&(r=a,0===He&&Ue(se)),e}())===a&&(e=function(){var e,r,n,u,o,c;return He++,e=Se,91===t.charCodeAt(Se)?(r=ae,Se++):(r=a,0===He&&Ue(ue)),r!==a&&at()!==a?((n=nt())===a&&(n=null),n!==a&&at()!==a&&(u=We())!==a&&at()!==a?((o=nt())===a&&(o=null),o!==a&&at()!==a?(93===t.charCodeAt(Se)?(c=oe,Se++):(c=a,0===He&&Ue(ce)),c!==a?(_e=e,r=ie(u),e=r):(Se=e,e=a)):(Se=e,e=a)):(Se=e,e=a)):(Se=e,e=a),e===a&&(e=Se,91===t.charCodeAt(Se)?(r=ae,Se++):(r=a,0===He&&Ue(ue)),r!==a&&at()!==a?(93===t.charCodeAt(Se)?(n=oe,Se++):(n=a,0===He&&Ue(ce)),n!==a?(_e=e,r=le(),e=r):(Se=e,e=a)):(Se=e,e=a)),He--,e===a&&(r=a,0===He&&Ue(ne)),e}())===a&&(e=Je())===a&&(e=function(){var e,t;return He++,e=Se,(t=Qe())!==a&&(_e=e,t=B(t)),He--,(e=t)===a&&(t=a,0===He&&Ue(Y)),e}())===a&&(e=function(){var e,r,n,u,o,c;if(He++,e=Se,r=[],P.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(M)),n!==a)for(;n!==a;)r.push(n),P.test(t.charAt(Se))?(n=t.charAt(Se),Se++):(n=a,0===He&&Ue(M));else r=a;if(r!==a){if(n=Se,46===t.charCodeAt(Se)?(u=z,Se++):(u=a,0===He&&Ue(U)),u!==a){if(o=[],P.test(t.charAt(Se))?(c=t.charAt(Se),Se++):(c=a,0===He&&Ue(M)),c!==a)for(;c!==a;)o.push(c),P.test(t.charAt(Se))?(c=t.charAt(Se),Se++):(c=a,0===He&&Ue(M));else o=a;o!==a?n=u=[u,o]:(Se=n,n=a)}else Se=n,n=a;n===a&&(n=null),n!==a?(_e=e,r=$(n),e=r):(Se=e,e=a)}else Se=e,e=a;return He--,e===a&&(r=a,0===He&&Ue(L)),e}())===a&&(e=tt()),e}function tt(){var e,r,n,u;if(He++,e=Se,34===t.charCodeAt(Se)?(r=Z,Se++):(r=a,0===He&&Ue(q)),r!==a){for(n=[],J.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(Q));u!==a;)n.push(u),J.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(Q));n!==a?(34===t.charCodeAt(Se)?(u=Z,Se++):(u=a,0===He&&Ue(q)),u!==a?(_e=e,e=r=V(n)):(Se=e,e=a)):(Se=e,e=a)}else Se=e,e=a;if(e===a)if(e=Se,39===t.charCodeAt(Se)?(r=W,Se++):(r=a,0===He&&Ue(ee)),r!==a){for(n=[],te.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(re));u!==a;)n.push(u),te.test(t.charAt(Se))?(u=t.charAt(Se),Se++):(u=a,0===He&&Ue(re));n!==a?(39===t.charCodeAt(Se)?(u=W,Se++):(u=a,0===He&&Ue(ee)),u!==a?(_e=e,e=r=V(n)):(Se=e,e=a)):(Se=e,e=a)}else Se=e,e=a;return He--,e===a&&(r=a,0===He&&Ue(K)),e}function rt(){var e,r,n,u;return He++,e=Se,(r=Qe())!==a&&at()!==a?(58===t.charCodeAt(Se)?(n=me,Se++):(n=a,0===He&&Ue(Ce)),n!==a&&at()!==a&&(u=et())!==a?(_e=e,e=r=be(r,u)):(Se=e,e=a)):(Se=e,e=a),e===a&&(e=Se,(r=tt())!==a&&at()!==a?(58===t.charCodeAt(Se)?(n=me,Se++):(n=a,0===He&&Ue(Ce)),n!==a&&at()!==a&&(u=et())!==a?(_e=e,e=r=xe(r,u)):(Se=e,e=a)):(Se=e,e=a)),He--,e===a&&(r=a,0===He&&Ue(ge)),e}function nt(){var e;return He++,t.substr(Se,2)===Re?(e=Re,Se+=2):(e=a,0===He&&Ue(Te)),e===a&&(13===t.charCodeAt(Se)?(e=we,Se++):(e=a,0===He&&Ue(Oe)),e===a&&(10===t.charCodeAt(Se)?(e=Pe,Se++):(e=a,0===He&&Ue(Me)))),He--,e===a&&0===He&&Ue(Ee),e}function at(){var e,r;for(He++,e=[],Ne.test(t.charAt(Se))?(r=t.charAt(Se),Se++):(r=a,0===He&&Ue(Ie));r!==a;)e.push(r),Ne.test(t.charAt(Se))?(r=t.charAt(Se),Se++):(r=a,0===He&&Ue(Ie));return He--,e===a&&(r=a,0===He&&Ue(je)),e}const ut={PARAGRAPH:1,COMMAND:2,TEXT:3,DICTIONARY:11,ARRAY:12,NUMBER:13,STRING:14};if((n=o())!==a&&Se===t.length)return n;throw n!==a&&Se<t.length&&Ue({type:"end"}),ot=Ge,ct=ke<t.length?t.charAt(ke):null,it=ke<t.length?ze(ke,ke+1):ze(ke,ke),new e(e.buildMessage(ot,ct),ot,ct,it);var ot,ct,it}}}();function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var a=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){function r(){var t=r.__proto__.apply(this,arguments);return Object.assign(t,e.apply(null,arguments)),t}return t=t||Error,Object.setPrototypeOf(r,t),r}t.SubError=n(function(e){return{name:"SubError",message:"SubError "+e.reduce(function(e,t){return e+="\n\n"+t.stack},""),errors:e}},Error),t.IterableError=n(function(e){return{name:"IterableError",message:"expecting an array or an iterable object but got "+(null===e?"null":void 0===e?"undefined":r(e))}},TypeError)});r(a);a.SubError,a.IterableError;var u=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.size=function(e){return Array.isArray(e)?e.length:Object.keys(e).length},t.repeat=function(e,t){for(var r=0;r<e;r++)t(r)},t.toArray=function(e){return Object.keys(e).map(function(t){return e[t]})},t.toBoolean=function(e){return!!e},t.identity=function(e){return e},t.defaults=function(e,t){var r=Object.assign({},t);return Object.keys(e).reduce(function(r,n){return r[n]=void 0===e[n]?t[n]:e[n],r},r)},t.isIterable=function(e){return e&&"function"==typeof e.entries},t.noop=function(){},t.isDefined=function(e){return void 0!==e}});r(u);u.size,u.repeat,u.toArray,u.toBoolean,u.identity,u.defaults,u.isIterable,u.noop,u.isDefined;var o=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(e){return Array.isArray(e)?Promise.all(e):Promise.resolve(e)}(e).then(function(e){return t&&!(0,u.isIterable)(e)?Promise.reject((0,a.IterableError)(e)):e})}});r(o);var c=r(n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.identity;return(0,n.default)(e).then(function(e){return Promise.all(e.map(t))})};var r,n=(r=o)&&r.__esModule?r:{default:r}}));const i={PARAGRAPH:1,COMMAND:2,TEXT:3,BLOCK:4,HTML:5,NODE:6,DICTIONARY:11,ARRAY:12,NUMBER:13,STRING:14},l={},s={},f=async(e,t)=>void 0!==l[e]?await l[e](...await c(t,e=>e.type===i.COMMAND?f(e.name,e.args):e)):(console.warn(`Command '${e}' not registered`),await T("b",{class:"error"},`${e}?`)),p=e=>(t,r,n=!1)=>{if(!n&&void 0!==e[t])return console.warn(`Command '${t}' is already registered. Set overwrite to true, if you need to overwrite the already registered command.`);e[t]=r},h=p(l),d=p(s),A=e=>t.parse(e).map(y),v={".":!0,",":!0},y=e=>{const t=[],r=e.value.reduce((e,r)=>(r.type===i.TEXT?v[r.value[0]]?(e.push({type:i.TEXT,value:r.value[0]+" "}),1!==r.value.length&&t.push({type:i.TEXT,value:r.value.substr(1)})):t.push(r):(t.length&&(e.push({type:i.TEXT,value:t.map(e=>e.value).join(" ")}),t.length=0),e.push(r)),e),[]);return t.length&&r.push({type:i.TEXT,value:t.map(e=>e.value).join(" ")}),{type:e.type,value:r}},g=e=>!!e,m=async(e,t)=>(await c(e,t)).flat(),C=async(e,t)=>(await c(e,t)).flat().filter(g),b=async e=>{if(e.split)return document.createTextNode(e);if(!e.type)return e;switch(e.type){case i.NODE:return e;case i.BLOCK:return console.log("block?"),await m(e.value,b);case i.PARAGRAPH:const t=await m(e.value,b);return t.length&&t.push(R("div",{class:"paragraph-break"})),t;case i.HTML:return R("span",{innerHTML:e.value});case i.TEXT:return document.createTextNode(e.value);case i.COMMAND:const r=[await f(e.name,e.args)].flat().filter(g);return await m(r,b)}console.error(e)},x=(e,t)=>{let r,n=!0;return t.forEach(t=>{t.type===i.PARAGRAPH?(n=!0,e.push(x([],t.value))):(n&&(n=!1,r={type:i.PARAGRAPH,value:[]},e.push(r)),r.value.push(t))}),e},E=async e=>{if(e.type!==i.COMMAND||!s[e.name])return e.type===i.PARAGRAPH?(e.value=await C(e.value,E),e):e;{const t=[await s[e.name](...e.args)].flat().filter(g),r=await m(t,E);if(void 0===l[e.name])return r}},R=(e,t)=>{let r=document.createElement(e);return Object.keys(t||{}).forEach(e=>r.setAttribute(e,t[e])),r},T=async(e,t,...r)=>{const n=R(e,t);for(let e=0;e<r.length;e++)n.appendChild(await b(r[e]));return n},w={prerender:[],postrender:[]},O=e=>(w[e]||[]).forEach(e=>e());e.TYPE=i,e.html=T,e.htmlLite=R,e.off=(e,t)=>{const r=w[e].indexOf(t);-1!==r&&w[e].splice(r,1)},e.on=(e,t)=>{w[e].includes(t)||w[e].push(t)},e.parse=A,e.registerCommand=h,e.registerPreprocessor=d,e.render=async(e,t)=>{for(;t.firstChild;)t.removeChild(t.firstChild);let r,n=0;const a=()=>{t.appendChild(r=R("section",{id:`page-${++n}`,class:"sheet","data-page":n})),r.appendChild(R("div",{class:"meta page-start"}))};a();const u=e=>{r.appendChild(e),r.scrollHeight>r.clientHeight&&(a(),r.appendChild(e))};O("prerender");const o=A(e).map(y),c=await(async e=>{const t=[];for(let r=0;r<e.length;r++){const n=x([],await C(e[r].value,E));t.push(...n)}return t.flat()})(o);for(let e=0;e<c.length;e++)(await b(c[e])).forEach(u);O("postrender")},e.verifyTypes=(e,...t)=>{const r=t.map((t,r)=>({expected:e[r],actual:t,index:r})).filter(e=>e.expected!==e.actual);return{ok:0===r.length,invalid:r}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=parser.js.map
