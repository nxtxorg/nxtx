{"version":3,"file":"parser.js","sources":["../../node_modules/awaity/__internal__/errors.js","../../node_modules/awaity/__internal__/utils.js","../../node_modules/awaity/__internal__/resolveAll.js","../../node_modules/awaity/map.js","../../src/parser.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction customError(fn, BaseError) {\n  BaseError = BaseError || Error;\n\n  function CustomError() {\n    // eslint-disable-next-line no-proto\n    var _this = CustomError.__proto__.apply(this, arguments);\n    Object.assign(_this, fn.apply(null, arguments));\n    return _this;\n  }\n\n  Object.setPrototypeOf(CustomError, BaseError);\n\n  return CustomError;\n}\n\nvar SubError = exports.SubError = customError(function (errors) {\n  var multiStack = errors.reduce(function (str, error) {\n    str += '\\n\\n' + error.stack;\n    return str;\n  }, '');\n\n  return {\n    name: 'SubError',\n    message: 'SubError ' + multiStack,\n    errors: errors\n  };\n}, Error);\n\nvar IterableError = exports.IterableError = customError(function (value) {\n  var type = value === null ? 'null' : typeof value === 'undefined' ? 'undefined' : _typeof(value);\n\n  return {\n    name: 'IterableError',\n    message: 'expecting an array or an iterable object but got ' + type\n  };\n}, TypeError);","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.size = size;\nexports.repeat = repeat;\nexports.toArray = toArray;\nexports.toBoolean = toBoolean;\nexports.identity = identity;\nexports.defaults = defaults;\nexports.isIterable = isIterable;\nexports.noop = noop;\nexports.isDefined = isDefined;\nfunction size(obj) {\n  return Array.isArray(obj) ? obj.length : Object.keys(obj).length;\n}\n\nfunction repeat(count, fn) {\n  // eslint-disable-next-line no-plusplus\n  for (var i = 0; i < count; i++) {\n    fn(i);\n  }\n}\n\nfunction toArray(obj) {\n  return Object.keys(obj).map(function (i) {\n    return obj[i];\n  });\n}\n\nfunction toBoolean(val) {\n  return !!val;\n}\n\nfunction identity(value) {\n  return value;\n}\n\nfunction defaults(obj, defaultObj) {\n  var initial = Object.assign({}, defaultObj);\n  return Object.keys(obj).reduce(function (results, key) {\n    results[key] = obj[key] === undefined ? defaultObj[key] : obj[key];\n    return results;\n  }, initial);\n}\n\nfunction isIterable(iterable) {\n  return iterable && typeof iterable.entries === 'function';\n}\n\nfunction noop() {}\n\nfunction isDefined(val) {\n  return val !== undefined;\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = resolveAll;\n\nvar _errors = require('./errors');\n\nvar _utils = require('./utils');\n\nfunction resolve(promises) {\n  return Array.isArray(promises) ? Promise.all(promises) : Promise.resolve(promises);\n}\n\nfunction resolveAll(promises) {\n  var rejectNonIterable = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  return resolve(promises).then(function (resolved) {\n    if (rejectNonIterable && !(0, _utils.isIterable)(resolved)) {\n      return Promise.reject((0, _errors.IterableError)(resolved));\n    }\n\n    return resolved;\n  });\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = map;\n\nvar _resolveAll = require('./__internal__/resolveAll');\n\nvar _resolveAll2 = _interopRequireDefault(_resolveAll);\n\nvar _utils = require('./__internal__/utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction map(iterable) {\n  var mapper = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _utils.identity;\n\n  return (0, _resolveAll2.default)(iterable).then(function (values) {\n    return Promise.all(values.map(mapper));\n  });\n}","/*  NxTx parser and renderer\r\n    Author: Malte Rosenbjerg\r\n    License: MIT */\r\n\r\nimport parser from '../grammar.pegjs';\r\nimport map from 'awaity/map';\r\n\r\nexport const TYPE = {\r\n    PARAGRAPH: 1,\r\n    COMMAND: 2,\r\n    TEXT: 3,\r\n    BLOCK: 4,\r\n    HTML: 5,\r\n    NODE: 6,\r\n\r\n    DICTIONARY: 11,\r\n    ARRAY: 12,\r\n    NUMBER: 13,\r\n    STRING: 14,\r\n};\r\n\r\nconst commands = {};\r\nconst preprocessors = {};\r\nconst executeCommand = async (cmd, args) => {\r\n    if (commands[cmd] !== undefined)\r\n        return await commands[cmd](...(await map(args, arg => arg.type === TYPE.COMMAND ? executeCommand(arg.name, arg.args) : arg)));\r\n    console.warn(`Command '${cmd}' not registered`);\r\n    return await html('b', {class: \"error\"}, `${cmd}?`);\r\n};\r\n\r\nconst register = cmdCollection => (cmd, fn, overwrite = false) => {\r\n    if (!overwrite && cmdCollection[cmd] !== undefined)\r\n        return console.warn(`Command '${cmd}' is already registered. Set overwrite to true, if you need to overwrite the already registered command.`);\r\n    cmdCollection[cmd] = fn;\r\n};\r\nexport const registerCommand = register(commands);\r\nexport const registerPreprocessor = register(preprocessors);\r\n\r\nexport const verifyTypes = (types, ...args) => {\r\n    const invalidTypes = args\r\n        .map((actual, index) => ({expected: types[index], actual, index}))\r\n        .filter(type => type.expected !== type.actual);\r\n    return { ok: invalidTypes.length === 0, invalid: invalidTypes }\r\n};\r\nexport const parse = text => parser.parse(text).map(mergeText);\r\n\r\nconst noMerge = { '.': true, ',': true };\r\nconst mergeText = pNode => {\r\n    const textNodes = [];\r\n    const mergedNodes = pNode.value.reduce((acc, node) => {\r\n        if (node.type === TYPE.TEXT) {\r\n            if (noMerge[node.value[0]]) {\r\n                acc.push({ type: TYPE.TEXT, value: node.value[0] + ' ' });\r\n                if (node.value.length !== 1) textNodes.push({ type: TYPE.TEXT, value: node.value.substr(1) });\r\n            }\r\n            else textNodes.push(node);\r\n        } else {\r\n            if (textNodes.length) {\r\n                acc.push({ type: TYPE.TEXT, value: textNodes.map(n => n.value).join(' ') });\r\n                textNodes.length = 0;\r\n            }\r\n            acc.push(node);\r\n        }\r\n        return acc;\r\n    }, []);\r\n    if (textNodes.length)\r\n        mergedNodes.push({ type: TYPE.TEXT, value: textNodes.map(n => n.value).join(' ') });\r\n    return { type: pNode.type, value: mergedNodes };\r\n};\r\n\r\n\r\nconst truthy = e => !!e;\r\nconst flatMap = async (elements, fn) => (await map(elements, fn)).flat();\r\nconst flatMapFilter = async (elements, fn) => (await map(elements, fn)).flat().filter(truthy);\r\n\r\nconst baseRenderNode = async node => {\r\n    if (node.split) return document.createTextNode(node);\r\n    if (!node.type) return node;\r\n    switch (node.type) {\r\n        case TYPE.NODE:\r\n            return node;\r\n        case TYPE.BLOCK:\r\n            console.log('block?');\r\n            return await flatMap(node.value, baseRenderNode);\r\n        case TYPE.PARAGRAPH:\r\n            const pNodes = await flatMap(node.value, baseRenderNode);\r\n            if (pNodes.length) pNodes.push(htmlLite('div', { class: 'paragraph-break' }));\r\n            return pNodes;\r\n        case TYPE.HTML:\r\n            return htmlLite('span', { innerHTML: node.value });\r\n        case TYPE.TEXT:\r\n            return document.createTextNode(node.value);\r\n        case TYPE.COMMAND:\r\n            const result = [ await executeCommand(node.name, node.args) ].flat().filter(truthy);\r\n            return await flatMap(result, baseRenderNode)\r\n    }\r\n    console.error(node);\r\n};\r\nconst flatten = (rootAccumulator, nodes) => {\r\n    let cleanParagraph;\r\n    let requiresNew = true;\r\n    nodes.forEach(node => {\r\n        if (node.type === TYPE.PARAGRAPH) {\r\n            requiresNew = true;\r\n            rootAccumulator.push(flatten([], node.value));\r\n        }\r\n        else {\r\n            if (requiresNew) {\r\n                requiresNew = false;\r\n                cleanParagraph = { type: TYPE.PARAGRAPH, value: [] };\r\n                rootAccumulator.push(cleanParagraph);\r\n            }\r\n            cleanParagraph.value.push(node);\r\n        }\r\n    });\r\n    return rootAccumulator;\r\n};\r\n\r\nconst executePreprocessor = async node => {\r\n    if (node.type === TYPE.COMMAND && preprocessors[node.name]) {\r\n        const result = [ await preprocessors[node.name](...node.args) ].flat().filter(truthy);\r\n        const childResults = await flatMap(result, executePreprocessor);\r\n        if (commands[node.name] === undefined) return childResults;\r\n    }\r\n    else if (node.type === TYPE.PARAGRAPH) {\r\n        node.value = await flatMapFilter(node.value, executePreprocessor);\r\n        return node;\r\n    }\r\n    else return node;\r\n};\r\nconst executePreprocessors = async paragraphs => {\r\n    const processedParagraphs = [];\r\n    for (let i = 0; i < paragraphs.length; i++) {\r\n        const flattened = flatten([], await flatMapFilter(paragraphs[i].value, executePreprocessor));\r\n        processedParagraphs.push(...flattened);\r\n    }\r\n    return processedParagraphs.flat();\r\n};\r\n\r\nexport const render = async (text, root) => {\r\n    while (root.firstChild) root.removeChild(root.firstChild);\r\n    let page = 0, currentPage;\r\n    const newPage = () => {\r\n        root.appendChild(currentPage = htmlLite('section', { id: `page-${++page}`, class: 'sheet', 'data-page': page }));\r\n        currentPage.appendChild(htmlLite('div', { class: 'meta page-start' }));\r\n    };\r\n    newPage();\r\n    const place = node => {\r\n        currentPage.appendChild(node);\r\n        if (currentPage.scrollHeight > currentPage.clientHeight) {\r\n            newPage();\r\n            currentPage.appendChild(node);\r\n        }\r\n    };\r\n    trigger('prerender');\r\n    const paragraphs = parse(text).map(mergeText);\r\n    const preprocessed = await executePreprocessors(paragraphs);\r\n    for (let i = 0; i < preprocessed.length; i++) {\r\n        const children = await baseRenderNode(preprocessed[i]);\r\n        children.forEach(place);\r\n    }\r\n    trigger('postrender');\r\n};\r\nexport const htmlLite = (nodeName, attributes) => {\r\n    let n = document.createElement(nodeName);\r\n    Object.keys(attributes || {}).forEach(k => n.setAttribute(k, attributes[k]));\r\n    return n;\r\n};\r\nexport const html = async (nodeName, attributes, ...children) => {\r\n    const n = htmlLite(nodeName, attributes);\r\n    for (let i = 0; i < children.length; i++) n.appendChild(await baseRenderNode(children[i]));\r\n    return n;\r\n};\r\n\r\nconst hooks = { prerender: [], postrender: [] };\r\nconst trigger = event => (hooks[event] || []).forEach(fn => fn());\r\nexport const on = (event, handler) => {\r\n    if (!hooks[event].includes(handler)) hooks[event].push(handler);\r\n};\r\nexport const off = (event, handler) => {\r\n    const index = hooks[event].indexOf(handler);\r\n    if (index !== -1) hooks[event].splice(index, 1);\r\n};"],"names":["Object","defineProperty","exports","value","_typeof","Symbol","iterator","obj","constructor","prototype","customError","fn","BaseError","CustomError","_this","__proto__","apply","this","arguments","assign","Error","setPrototypeOf","errors","name","message","reduce","str","error","stack","TypeError","Array","isArray","length","keys","count","i","map","val","defaultObj","initial","results","key","undefined","iterable","entries","promises","rejectNonIterable","Promise","all","resolve","then","resolved","_utils","isIterable","reject","_errors","IterableError","mapper","identity","_resolveAll2","default","values","_resolveAll","__esModule","TYPE","PARAGRAPH","COMMAND","TEXT","BLOCK","HTML","NODE","DICTIONARY","ARRAY","NUMBER","STRING","commands","preprocessors","executeCommand","async","cmd","args","arg","type","console","warn","html","class","register","cmdCollection","overwrite","registerCommand","registerPreprocessor","parse","text","parser","mergeText","noMerge",".",",","pNode","textNodes","mergedNodes","acc","node","push","substr","n","join","truthy","e","flatMap","elements","flat","flatMapFilter","filter","baseRenderNode","split","document","createTextNode","log","pNodes","htmlLite","innerHTML","result","flatten","rootAccumulator","nodes","cleanParagraph","requiresNew","forEach","executePreprocessor","childResults","nodeName","attributes","createElement","k","setAttribute","children","appendChild","hooks","prerender","postrender","trigger","event","handler","index","indexOf","splice","includes","root","firstChild","removeChild","currentPage","page","newPage","id","data-page","place","scrollHeight","clientHeight","paragraphs","preprocessed","processedParagraphs","flattened","executePreprocessors","types","invalidTypes","actual","expected","ok","invalid"],"mappings":"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"}